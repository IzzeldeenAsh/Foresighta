<!-- Loading State -->
<div *ngIf="isLoading" class="d-flex justify-content-center align-items-center min-h-300px">
  <span class="spinner-border spinner-border-md align-middle mx-2 text-info"></span>
</div>

<!-- Fullscreen loading overlay for AI generation -->
<div *ngIf="isDescriptionLoading" class="fullscreen-loading-overlay">
  <div class="loading-content">
    <div class="loading-stars">
      <!-- Star 1 -->
      <div class="loading-star">
        <svg width="30" height="30" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.96007 2.04365C6.05608 1.63864 6.63242 1.63864 6.72843 2.04365L6.82277 2.44161C7.27408 4.34549 8.81369 5.79905 10.7403 6.14025V6.14025C11.126 6.20856 11.126 6.76196 10.7403 6.83026V6.83026C8.81369 7.17146 7.27408 8.62503 6.82277 10.5289L6.72843 10.9269C6.63242 11.3319 6.05608 11.3319 5.96007 10.9269L5.86573 10.5289C5.41442 8.62502 3.87481 7.17146 1.94815 6.83026V6.83026C1.56245 6.76196 1.56245 6.20856 1.94815 6.14025V6.14025C3.87481 5.79905 5.41442 4.34549 5.86573 2.44161L5.96007 2.04365Z" fill="#FF9900"/>
        </svg>
      </div>
      <!-- Star 2 -->
      <div class="loading-star">
        <svg width="25" height="25" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13.2439 1.92875C13.28 1.76954 13.5068 1.76954 13.5429 1.92875L13.5808 2.09614C13.7472 2.83083 14.3351 3.39591 15.0758 3.53318V3.53318C15.2226 3.56039 15.2226 3.77076 15.0758 3.79797V3.79797C14.3351 3.93524 13.7472 4.50032 13.5808 5.23502L13.5429 5.40241C13.5068 5.56161 13.28 5.56161 13.2439 5.40241L13.206 5.23502C13.0396 4.50032 12.4518 3.93524 11.7111 3.79797V3.79797C11.5642 3.77076 11.5642 3.56039 11.7111 3.53318V3.53318C12.4518 3.39591 13.0396 2.83083 13.206 2.09614L13.2439 1.92875Z" fill="#FFB347"/>
        </svg>
      </div>
      <!-- Star 3 -->
      <div class="loading-star">
        <svg width="20" height="20" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14.4739 9.2714C14.5223 9.07456 14.8022 9.07456 14.8506 9.2714L14.9018 9.47927C15.1251 10.3869 15.8584 11.0801 16.7771 11.2523V11.2523C16.9622 11.287 16.9622 11.5523 16.7771 11.587V11.587C15.8584 11.7591 15.1251 12.4524 14.9018 13.36L14.8506 13.5679C14.8022 13.7647 14.5223 13.7647 14.4739 13.5679L14.4227 13.36C14.1994 12.4524 13.4661 11.7591 12.5475 11.587V11.587C12.3623 11.5523 12.3623 11.287 12.5475 11.2523V11.2523C13.4661 11.0801 14.1994 10.3869 14.4227 9.47927L14.4739 9.2714Z" fill="#FFD700"/>
        </svg>
      </div>
    </div>
    <div class="loading-text">
      Generating AI Information
      <span class="loading-dots">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </span>
    </div>
    
    <!-- Magical effect to show the AI is thinking -->
    <div class="loading-magic-effect">
      <div class="magic-particle"></div>
      <div class="magic-particle"></div>
      <div class="magic-particle"></div>
      <div class="magic-particle"></div>
      <div class="magic-particle"></div>
      <div class="magic-particle"></div>
    </div>
  </div>
</div>

<!-- Content Section -->
<div *ngIf="!isLoading">
  <div class="pb-10 pb-lg-15">
    <h2 class="fw-bolder text-gray-900">
      {{ "VIEW_MY_KNOWLEDGE.KNOWLEDGE_DETAILS" | translate }}
    </h2>
    <div class="text-gray-500 fw-bold fs-6">
      {{ "IF_NEED_MORE_INFO" | translate }}
      <a class="link-primary fw-bolder">{{ "HELP_PAGE" | translate }}</a>.
    </div>
  </div>

  <!-- Knowledge Details Form -->
  <form [formGroup]="form">
   <!-- Generate AI Description button - only show if not loading and no description yet -->
  
    <div class="d-flex justify-content-end">
      <div class="max-w-200px">
        <div *ngIf="!isDescriptionLoading && (!form.get('description')?.value || !form.get('description')?.value?.trim())" class="cursor-pointer border-none border-0">
          <div (click)="generateAIDescription()" class="loader-container px-3" style="min-height: 30px; cursor: pointer;">
            <div class="steel-shining-text no-animation" style="font-size: 0.85rem;">
              <svg width="16" height="13" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 5px;">
                <path class="star star-small" d="M14.4739 9.2714C14.5223 9.07456 14.8022 9.07456 14.8506 9.2714L14.9018 9.47927C15.1251 10.3869 15.8584 11.0801 16.7771 11.2523V11.2523C16.9622 11.287 16.9622 11.5523 16.7771 11.587V11.587C15.8584 11.7591 15.1251 12.4524 14.9018 13.36L14.8506 13.5679C14.8022 13.7647 14.5223 13.7647 14.4739 13.5679L14.4227 13.36C14.1994 12.4524 13.4661 11.7591 12.5475 11.587V11.587C12.3623 11.5523 12.3623 11.287 12.5475 11.2523V11.2523C13.4661 11.0801 14.1994 10.3869 14.4227 9.47927L14.4739 9.2714Z" fill="url(#paint0_linear_2012_9)"/>
                <path class="star star-large" d="M5.96007 2.04365C6.05608 1.63864 6.63242 1.63864 6.72843 2.04365L6.82277 2.44161C7.27408 4.34549 8.81369 5.79905 10.7403 6.14025V6.14025C11.126 6.20856 11.126 6.76196 10.7403 6.83026V6.83026C8.81369 7.17146 7.27408 8.62503 6.82277 10.5289L6.72843 10.9269C6.63242 11.3319 6.05608 11.3319 5.96007 10.9269L5.86573 10.5289C5.41442 8.62502 3.87481 7.17146 1.94815 6.83026V6.83026C1.56245 6.76196 1.56245 6.20856 1.94815 6.14025V6.14025C3.87481 5.79905 5.41442 4.34549 5.86573 2.44161L5.96007 2.04365Z" fill="url(#paint1_linear_2012_9)"/>
                <path class="star star-medium" d="M13.2439 1.92875C13.28 1.76954 13.5068 1.76954 13.5429 1.92875L13.5808 2.09614C13.7472 2.83083 14.3351 3.39591 15.0758 3.53318V3.53318C15.2226 3.56039 15.2226 3.77076 15.0758 3.79797V3.79797C14.3351 3.93524 13.7472 4.50032 13.5808 5.23502L13.5429 5.40241C13.5068 5.56161 13.28 5.56161 13.2439 5.40241L13.206 5.23502C13.0396 4.50032 12.4518 3.93524 11.7111 3.79797V3.79797C11.5642 3.77076 11.5642 3.56039 11.7111 3.53318V3.53318C12.4518 3.39591 13.0396 2.83083 13.206 2.09614L13.2439 1.92875Z" fill="url(#paint2_linear_2012_9)"/>
                <defs>
                <linearGradient id="paint0_linear_2012_9" x1="14.6623" y1="8.41199" x2="14.6623" y2="14.4273" gradientUnits="userSpaceOnUse">
                <stop stop-color="#FF9900"/>
                <stop offset="0.22" stop-color="#FFE4A6"/>
                <stop offset="1" stop-color="#FF9900"/>
                </linearGradient>
                <linearGradient id="paint1_linear_2012_9" x1="6.34425" y1="0.422974" x2="6.34425" y2="12.5475" gradientUnits="userSpaceOnUse">
                <stop stop-color="#FFBB3D"/>
                <stop offset="0.22" stop-color="#FFF2A0"/>
                <stop offset="1" stop-color="#FF9900"/>
                </linearGradient>
                <linearGradient id="paint2_linear_2012_9" x1="13.3934" y1="1.26886" x2="13.3934" y2="6.06229" gradientUnits="userSpaceOnUse">
                <stop stop-color="#FFCF3D"/>
                <stop offset="0.22" stop-color="#FFE4BD"/>
                <stop offset="1" stop-color="#FF9900"/>
                </linearGradient>
                </defs>
              </svg>
              Generate AI Information
            </div>
          </div>
        </div>
      </div>
    </div>
      <!-- Knowledge Title -->
      <div class="mb-10 fv-row">
        <div class="d-flex justify-content-between">
        <label class="d-flex align-items-center form-label mb-3 required">
          <ng-container *ngIf="defaultValues.knowledgeType === 'course'">
            {{ "COURSE_TITLE" | translate }}
          </ng-container>
          <ng-container *ngIf="defaultValues.knowledgeType === 'media'">
            {{ "MEDIA_TITLE" | translate }}
          </ng-container>
          <ng-container *ngIf="defaultValues.knowledgeType === 'data'">
            {{ "DATA_TITLE" | translate }}
          </ng-container>
          <ng-container *ngIf="defaultValues.knowledgeType === 'report'">
            {{ "REPORT_TITLE" | translate }}
          </ng-container>
          <ng-container *ngIf="defaultValues.knowledgeType === 'manual'">
            {{ "MANUAL_TITLE" | translate }}
          </ng-container>
          <ng-container *ngIf="defaultValues.knowledgeType === 'insight'">
            {{ "INSIGHT_TITLE" | translate }}
          </ng-container>
          <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'KNOWLEDGE_TITLE_TOOLTIP' | translate }}"></i>
        </label>
       
        </div>
            <div class="row mb-2 mt-2">
              <div class="col-lg-12">
                <div class="position-relative">
                  <input pInputText formControlName="title" class="w-100" placeholder="{{ 'ENTER_KNOWLEDGE_TITLE' | translate }}" />
                  
                  <!-- Loading indicator for title field -->
                  <div *ngIf="isDescriptionLoading" class="field-loading-indicator">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  </div>
                  
                  <div
                    *ngIf="form.get('title')?.hasError('required') && form.get('title')?.touched"
                    class="fv-plugins-message-container invalid-feedback"
                  >
                    {{ "KNOWLEDGE_TITLE_REQUIRED" | translate }}
                  </div>
                </div>
              </div>
            </div>
          </div>
      
          <!-- Knowledge Description -->
          <div class="mb-10 fv-row">
            <label class="d-flex align-items-center form-label mb-3 required">
              {{ "KNOWLEDGE_DESCRIPTION" | translate }}
              <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'KNOWLEDGE_DESCRIPTION_TOOLTIP' | translate }}"></i>
            </label>
            <div class="row mb-2">
              <div class="col-lg-12">
                <div class="position-relative">
                  <!-- Animated abstract display -->
                  <div *ngIf="animatedAbstract && !showEditor" class="animated-abstract p-3 border rounded mb-3">
                    <div [innerHTML]="animatedAbstractText" class="typing-text"></div>
                    <div *ngIf="animatedAbstractComplete" class="text-end mt-2">
                      <button type="button" class="btn btn-sm btn-light" (click)="showDescriptionEditor()">
                        <i class="fas fa-edit me-1"></i> Edit
                      </button>
                    </div>
                  </div>
                  
                  <!-- Editor (only shown when not in animation mode) -->
                  <editor
                    *ngIf="showEditor"
                    apiKey="fovwl5u83es9vkiv7x6h34fynj0utg108qrb0edwwwlxevt9"
                    formControlName="description"
                    [init]="{min_height: 250, placeholder: ('ENTER_KNOWLEDGE_DESCRIPTION' | translate)}"
                  ></editor>
                  
                  <!-- AI Abstract Error Message -->
                  <div *ngIf="aiAbstractError" class="alert alert-warning mt-2 mb-2">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Couldn't get AI Abstract. Please try again or enter description manually.
                  </div>
                  
                  <div
                    *ngIf="form.get('description')?.hasError('required') && form.get('description')?.touched"
                    class="fv-plugins-message-container invalid-feedback"
                  >
                    {{ "KNOWLEDGE_DESCRIPTION_REQUIRED" | translate }}
                  </div>
                </div>
              </div>
            </div>
          </div>
      
          <!-- Knowledge Language -->
          <div class="mb-10 fv-row">
            <label class="d-flex align-items-center form-label mb-3 required">
              <ng-container *ngIf="defaultValues.knowledgeType === 'course'">
                {{ "COURSE_LANGUAGE" | translate }}
              </ng-container>
              <ng-container *ngIf="defaultValues.knowledgeType === 'media'">
                {{ "MEDIA_LANGUAGE" | translate }}
              </ng-container>
              <ng-container *ngIf="defaultValues.knowledgeType === 'data'">
                {{ "DATA_LANGUAGE" | translate }}
              </ng-container>
              <ng-container *ngIf="defaultValues.knowledgeType === 'report'">
                {{ "REPORT_LANGUAGE" | translate }}
              </ng-container>
              <ng-container *ngIf="defaultValues.knowledgeType === 'manual'">
                {{ "MANUAL_LANGUAGE" | translate }}
              </ng-container>
              <ng-container *ngIf="defaultValues.knowledgeType === 'insight'">
                {{ "INSIGHT_LANGUAGE" | translate }}
              </ng-container>
              <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'KNOWLEDGE_LANGUAGE_TOOLTIP' | translate }}"></i>
            </label>
            <div class="row mb-2">
              <div class="col-lg-12">
                <div class="position-relative">
                  <p-dropdown
                    [options]="languages"
                    formControlName="language"
                    [filter]="true"
                    filterBy="name"
                    [showClear]="true"
                    placeholder="{{ 'ENTER_KNOWLEDGE_LANGUAGE' | translate }}"
                    optionLabel="name"
                    optionValue="id"
                    styleClass="w-100"
                    [loading]="isLanguageFieldLoading"
                  >
                  </p-dropdown>
                  
                  <!-- No need for separate loading indicator since p-dropdown has built-in loading state -->
                  
                  <div
                    *ngIf="form.get('language')?.hasError('required') && form.get('language')?.touched"
                    class="fv-plugins-message-container invalid-feedback"
                  >
                    {{ "KNOWLEDGE_LANGUAGE_REQUIRED" | translate }}
                  </div>
                </div>
              </div>
            </div>
          </div>
      
            <!-- Industry -->
            <div class="mb-10">
              <app-industry-selector
                [title]="currentLanguage == 'ar' ? 'اختر الصناعة' : 'Choose knowledge industry'"
                [placeholder]="currentLanguage == 'ar' ? 'اختر الصناعة' : 'Choose knowledge industry'"
                [fetchedData]="industryNodes"
                [cancelLabel]="currentLanguage == 'ar' ? 'الغاء' : 'Cancel'"
                [okLabel]="currentLanguage == 'ar' ? 'تأكيد' : 'Ok'"
                [tip]="currentLanguage == 'ar' ? ' اختر الصناعة المتعلقة بهذه المعرفة' : 'Select the industry related to your knowledge'"
                [selectedIndustryId]="form.get('industry')?.value"
                [isRequired]="true"
                (nodeSelected)="onIndustrySelected($event)"
              >
              </app-industry-selector>
            </div>
    <!-- Topics -->
    <div [@fadeInMoveY] class="mb-10" *ngIf="topics && topics.length > 0">
      <label class="d-flex align-items-center form-label mb-3 required">
        {{ "SELECT_TOPIC" | translate }}
        <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'TOPIC_TOOLTIP' | translate }}"></i>
      </label>
      <p-dropdown
        id="topicId"
        formControlName="topicId"
        [options]="topics"
        optionLabel="name"
        optionValue="id"
        placeholder="{{ 'ENTER_TOPIC' | translate }}"
        [showClear]="true"
        [filter]="true"
        filterPlaceholder="{{ 'SEARCH_TOPICS' | translate }}"
        class="w-100"
        (onChange)="onTopicSelected($event.value)"
      ></p-dropdown>
      <div *ngIf="form.controls['topicId']?.invalid && form.controls['topicId']?.touched" class="text-danger">
        {{ "TOPIC_REQUIRED" | translate }}
      </div>
    </div>

    <!-- Custom Topic Input -->
    <div [@fadeInMoveY] class="mb-10" *ngIf="form.get('topicId')?.value === 'other'">
      <label class="d-flex align-items-center form-label mb-3 required">
        {{ "SPECIFY_OTHER_TOPIC" | translate }}
        <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'TOPIC_TOOLTIP' | translate }}"></i>
      </label>
      <input
        type="text"
        pInputText
        class="w-100"
        formControlName="customTopic"
        placeholder="{{ 'ENTER_CUSTOM_TOPIC' | translate }}"
      />
      <!-- Duplicate Topic Error -->
      <div
        class="invalid-feedback d-block"
        *ngIf="form.get('customTopic')?.errors?.['duplicateTopic'] && form.get('customTopic')?.touched"
      >
        {{ "DUPLICATE_TOPIC" | translate }}
      </div>
      <!-- Required Field Error -->
      <div
        class="fv-plugins-message-container invalid-feedback"
        *ngIf="form.get('customTopic')?.errors?.['required'] && form.get('customTopic')?.touched"
      >
        {{ "CUSTOM_TOPIC_REQUIRED" | translate }}
      </div>
    </div>

    <!-- Target Market -->
    <div class="mb-10">
      <label class="d-flex align-items-center form-label mb-3 required">
        {{ "SELECT_TARGET_MARKET" | translate }}
        <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'TARGET_MARKET_TOOLTIP' | translate }}"></i>
      </label>

   <div class="d-flex justify-content-start gap-4 pt-10">
    <div class="form-check mb-3">
      <input
        type="radio"
        class="form-check-input"
        formControlName="targetMarket"
        name="targetMarket"
        value="1"
        id="targetMarket2"
        [checked]="true"
      />
      <label class="form-check-label text-gray-700" for="targetMarket2">
        {{ "COUNTRIES_AND_REGIONS" | translate }}
      </label>
    </div>

    <div class="form-check">
      <input
        type="radio"
        class="form-check-input"
        formControlName="targetMarket"
        name="targetMarket"
        value="2"
        id="targetMarket1"
      />
      <label class="form-check-label text-gray-700" for="targetMarket1">
        {{ "ECONOMIC_BLOCK" | translate }}
      </label>
    </div>

   </div>
      <div
        class="fv-plugins-message-container invalid-feedback"
        *ngIf="form.get('targetMarket')?.invalid && form.get('targetMarket')?.touched"
      >
        {{ "TARGET_MARKET_REQUIRED" | translate }}
      </div>
    </div>

    <!-- Region -->
    <div class="mb-10">
      <div *ngIf="form.get('targetMarket')?.value === '1'">
        <label class="d-flex align-items-center form-label mb-3 required">
          {{ "COUNTRIES_AND_REGIONS" | translate }}
          <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'REGION_TOOLTIP' | translate }}"></i>
        </label>
        <app-select-region
          #regionSelector
          placeholder="{{ 'ENTER_REGION' | translate }}"
          title="{{ 'CHOOSE_REGIONS' | translate }}"
          [preSelectedRegions]="defaultValues.regions"
          [preSelectedCountries]="defaultValues.countries"
          (regionsSelected)="onRegionsSelected($event)"
        ></app-select-region>
      </div>
    </div>

    <!-- Economic Block -->
    <div class="mb-10">
      <div *ngIf="form.get('targetMarket')?.value === '2'">
        <label class="d-flex align-items-center form-label mb-3 required">
          {{ "ECONOMIC_BLOCK" | translate }}
          <i class="fas fa-exclamation-circle mx-2 fs-7" ngbTooltip="{{ 'ECONOMIC_BLOCK_TOOLTIP' | translate }}"></i>
        </label>
        <app-select-economic-block
          #economicBlockSelector
          placeholder="{{ 'ENTER_ECONOMIC_BLOCK' | translate }}"
          title="{{ 'CHOOSE_ECONOMIC_BLOCKS' | translate }}"
          [selectedBlockIds]="selectedEconomicBlocIds"
          (blocksSelected)="onEconomicBlocksSelected($event)"
        ></app-select-economic-block>
      </div>
    </div>

    <!-- ISIC Code -->
    <div class="mb-10 fv-row">
      <app-industry-selector
        [title]="currentLanguage == 'ar' ? 'اختر الرمز الصناعي' : 'Choose an ISIC Code'"
        [placeholder]="currentLanguage == 'ar' ? 'اختر الرمز الصناعي' : 'Choose an ISIC Code'"
        [fetchedData]="isicCodeNodes"
        [cancelLabel]="currentLanguage == 'ar' ? 'الغاء' : 'Cancel'"
        [selectedIndustryId]="form.get('isic_code')?.value"
        [okLabel]="currentLanguage == 'ar' ? 'تأكيد' : 'Ok'"
        [tip]="
          currentLanguage == 'ar'
            ? 'اختر الرمز الصناعي الأفضل لمعرفتك'
            : 'Select the ISIC code related to your knowledge'
        "
        (nodeSelected)="onIsicCodeSelected($event)"
        [isRequired]="false"
      >
      </app-industry-selector>
    </div>

    <!-- HS Code -->
    <div class="mb-10 fv-row" [@fadeInMoveY] *ngIf="selectedIsicId">
      <app-get-hs-code-by-isic
        [isicCodeId]="selectedIsicId"
        [isRequired]="false"
        [language]="currentLanguage"
        [preselectedHSCodeId]="form.get('hs_code')?.value"
        (hsCodeSelected)="onHSCodeSelected($event)"
      >
      </app-get-hs-code-by-isic>
    </div>

    <!-- Tags Section -->
    <div class="mt-10 mb-8" *ngIf="form.get('topicId')?.value && form.get('topicId')?.value !== ''">
      <div class="d-flex justify-content-between align-items-center mb-5">
        <label class="d-flex align-items-center fs-5 fw-semibold">
          <span class="required">{{ "SELECT_TAGS" | translate }}</span>
        </label>
        <div class="d-flex gap-3">
          <button
            type="button"
            class="btn btn-sm btn-light-info text-info text-hover-white text-active-white"
            (click)="selectAll()"
          >
            {{ "SELECT_ALL" | translate }}
          </button>
          <button
            type="button"
            class="btn btn-sm btn-light-warning text-warning text-hover-white text-active-white"
            (click)="clearAll()"
          >
            {{ "CLEAR_ALL" | translate }}
          </button>
          <button
            type="button"
            class="btn btn-sm btn-light-success text-success text-hover-white text-active-white"
            (click)="openAddCustomTag()"
          >
            {{ "ADD_CUSTOM_TAG" | translate }}
          </button>
        </div>
      </div>
      <div class="chip-group mb-5">
        <div class="chip" *ngFor="let chip of chips" [class.selected]="chip.selected" (click)="toggleSelection(chip)">
          <span class="check-icon" *ngIf="chip.selected">
            <i class="pi pi-check" style="font-size: 1rem"></i>
          </span>
          <span>{{ chip.label }}</span>
        </div>
      </div>
    </div>

    <!-- Add Custom Tag Modal using PrimeNG Dialog -->
    <p-dialog
      header="{{ 'ADD_CUSTOM_TAG' | translate }}"
      [(visible)]="isAddingCustomTag"
      modal="true"
      [closable]="false"
      [style]="{ width: '400px' }"
    >
      <form [formGroup]="customTagForm" (ngSubmit)="submitCustomTag()">
        <div class="p-fluid">
          <div class="p-field">
            <label for="name">{{ "TAG_NAME" | translate }}</label>
            <input id="name" type="text" pInputText formControlName="name" />
            <small
              *ngIf="customTagForm.get('name')?.invalid && customTagForm.get('name')?.touched"
              class="p-error"
            >
              {{ "TAG_NAME_REQUIRED" | translate }}
            </small>
          </div>
        </div>
        <div class="p-dialog-footer d-flex justify-content-end gap-3 mt-5">
          <button
            type="button"
            class="btn btn-light-danger btn-sm px-6"
            (click)="closeAddCustomTag()"
          >
            <span class="indicator-label">{{ "CANCEL" | translate }}</span>
          </button>
          <button
            type="submit"
            class="btn btn-primary btn-sm px-6"
            [disabled]="customTagForm.invalid"
          >
            <span class="indicator-label">{{ "ADD_TAG" | translate }}</span>
          </button>
        </div>
      </form>
    </p-dialog>

    <!-- Keywords Section -->
    <div class="mt-10 mb-10" *ngIf="form.get('topicId')?.value && form.get('topicId')?.value !== ''">
      <label class="d-flex align-items-center fs-5 fw-semibold mb-5">
        <span class="required">{{ "KEYWORDS" | translate }}</span>
      </label>
      <tag-input
        formControlName="keywords"
        [secondaryPlaceholder]="'ENTER_KEYWORDS' | translate"
        [separatorKeyCodes]="[188, 13]"
        [addOnBlur]="true"
        [required]="true"
        [placeholder]="'ENTER_KEYWORDS' | translate"
        (onAdd)="addKeyword($event)"
        (onRemove)="removeKeyword($event)"
      >
        <tag-input-dropdown
          [showDropdownIfEmpty]="true"
          [autocompleteItems]="availableKeywords"
        ></tag-input-dropdown>
      </tag-input>
    </div>

  


  </form>
</div> 