<div class="pb-10 pb-lg-12">
  <h2 class="fw-bolder text-gray-900">
    {{ "KNOWLEDGE_DOCUMENTS_INFO" | translate }}
  </h2>
  <div class="text-gray-500 fw-bold fs-6">
    {{ "DESCRIBE_KNOWLEDGE_AND_DOCUMENTS" | translate }}
    <a class="link-primary fw-bolder">{{ "HELP_PAGE" | translate }}</a>.
  </div>
</div>

<div [formGroup]="form">
  <!-- <div class="mb-10">
    <label class="form-label required">{{ "KNOWLEDGE_DESCRIPTION" | translate }}</label>
    <textarea 
      class="form-control form-control-lg"
      formControlName="description"
      rows="4"
      placeholder="{{ 'ENTER_KNOWLEDGE_DESCRIPTION' | translate }}"
    ></textarea>
 
  </div>

  <div *ngIf="isLoading" class="d-flex justify-content-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ "LOADING" | translate }}</span>
    </div>
  </div> -->

  <div *ngIf="!isLoading && documents.length > 0">
   
    <div class="mb-5" *ngFor="let doc of documents">
        <div class="d-flex align-items-center mb-3">
          <div class="fs-5 fw-bold">
            <div class="d-flex align-items-center">
              <img [src]="doc.fileIcon" 
                  [alt]="doc.file_extension" 
                  style="width: 38px; height: 38px; margin-right: 15px;" />
              {{ doc.file_name }}
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">{{ "DOCUMENT_DESCRIPTION" | translate }}</label>
          <textarea 
            class="form-control"
            [ngClass]="{'is-invalid': doc.touched && doc.hasError}"
            rows="3"
            [value]="doc.description || ''"
            (input)="updateDocumentDescription(doc.id, descInput.value)"
            #descInput
            placeholder="{{ 'ENTER_DOCUMENT_DESCRIPTION' | translate }}"
          ></textarea>
          <div *ngIf="doc.touched && doc.hasError" class="invalid-feedback">
            {{ "DOCUMENT_DESCRIPTION_REQUIRED" | translate }}
          </div>
        </div>
        
        <!-- Chapter toggle checkbox -->
        <div class="form-check form-switch mb-3">
          <input class="form-check-input" 
                 type="checkbox" 
                 role="switch" 
                 [checked]="doc.showChapters"
                 (change)="toggleChapters(doc.id)"
                 id="chapterToggle{{doc.id}}">
          <label class="form-check-label" for="chapterToggle{{doc.id}}">
            {{ "ADD_TABLE_OF_CONTENT" | translate }}
          </label>
        </div>
        
        <!-- Chapters section with table format -->
        <div *ngIf="doc.showChapters" class="ps-4 border-start border-3 border-light-primary mb-3">
          <div class="fs-6 fw-bold mb-3">{{ "TABLE_OF_CONTENT" | translate }}</div>
          
          <!-- List of added chapters in table format -->
          <div *ngIf="doc.chapters && doc.chapters.length > 0" class="mb-3">
            <table class="table table-row-dashed table-row-gray-300 align-middle">
              <thead>
                <tr class="fw-bold">
                  <th class="w-50px">#</th>
                  <th>{{ "CHAPTER_NAME" | translate }}</th>
                  <th class="w-75px text-end">{{ "ACTIONS" | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let chapter of doc.chapters; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ chapter.title }}</td>
                  <td class="text-end">
                    <button type="button" 
                            class="btn btn-sm btn-icon btn-light-danger" 
                            (click)="removeChapter(doc.id, i)"
                            title="{{ 'REMOVE_CHAPTER' | translate }}">
                      <i class="fas fa-times"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Add new chapter form -->
          <div class="d-flex align-items-center">
            <div class="flex-grow-1 me-3">
              <input type="text" 
                     class="form-control form-control-sm" 
                     [(ngModel)]="doc.newChapterTitle" 
                     [ngModelOptions]="{standalone: true}"
                     placeholder="{{ 'ENTER_CHAPTER_NAME' | translate }}"
                     (keydown.enter)="addChapter(doc.id)">
            </div>
            <button type="button" 
                    class="btn btn-sm btn-primary" 
                    (click)="addChapter(doc.id)"
                    [disabled]="!doc.newChapterTitle || !doc.newChapterTitle.trim()">
              {{ "ADD" | translate }}
            </button>
          </div>
          
       
        </div>
    </div>
  </div>

  <div *ngIf="!isLoading && documents.length === 0" class="alert alert-info">
    {{ "NO_DOCUMENTS_UPLOADED" | translate }}
  </div>
</div> 