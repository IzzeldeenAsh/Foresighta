<!-- Company Management Page -->
<div class="card mb-5 mb-xl-10">
  <!-- Header -->
  <div class="card-header border-0 pt-5">
    <h3 class="card-title align-items-start flex-column">
      <span class="card-label fw-bold fs-3 mb-1">My Company</span>
      <span class="text-muted mt-1 fw-semibold fs-7">Manage your company employees</span>
    </h3>
    <div class="card-toolbar">
      <button type="button" class="btn btn-sm btn-light-primary" (click)="openAddEmployeeModal()">
        <i class="ki-duotone ki-plus fs-2"></i>
        Add Employee
      </button>
    </div>
  </div>
  <!-- Body -->
  <div class="card-body py-3">
    <!-- Content -->
    <div class="d-flex flex-column align-items-center justify-content-center py-8">
      <div class="symbol symbol-100px symbol-circle mb-7">
        <img src="./assets/media/illustrations/sigma-1/16.png" alt="company image" />
      </div>
      <h2 class="fw-bold text-gray-800">Your Company Name</h2>
      <div class="fs-6 mb-5 text-gray-600">
        Manage your company settings and employees
      </div>
    </div>
  </div>
</div>

<!-- Add Employee Modal -->
<p-dialog 
  [(visible)]="displayAddEmployeeModal" 
  [style]="{width: '800px'}" 
  header="Add Employee" 
  [modal]="true" 
  [draggable]="false" 
  [resizable]="false"
  appendTo="body"
  [closeOnEscape]="true"
  (onHide)="closeAddEmployeeModal()"
  >
  
  <!-- Email input form -->
  <div class="mb-5">
    <form [formGroup]="emailForm">
      <div class="mb-3">
        <label class="form-label required">Email Address</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="ki-duotone ki-sms fs-4">
              <span class="path1"></span>
              <span class="path2"></span>
            </i>
          </span>
          <input 
            type="email" 
            class="form-control" 
            placeholder="Enter email address" 
            formControlName="email"
            pInputText
          />
        </div>
        <!-- Validation messages -->
        <div *ngIf="emailForm.get('email')?.touched">
          <div *ngIf="emailForm.get('email')?.hasError('required')" class="fv-plugins-message-container">
            <div class="fv-help-block">Email is required</div>
          </div>
          <div *ngIf="emailForm.get('email')?.hasError('email')" class="fv-plugins-message-container">
            <div class="fv-help-block">Email is invalid</div>
          </div>
        </div>
      </div>
    </form>
  </div>
  
  <!-- Processing indicator -->
  <div *ngIf="isCheckingAccount" class="d-flex justify-content-center mb-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <span class="ms-2">Checking account...</span>
  </div>
  
  <!-- Error message -->
  <div *ngIf="accountExistError" class="alert alert-danger mb-5">
    {{ accountExistError }}
  </div>
  
  <!-- Account exists - show user info -->
  <div *ngIf="accountExists && accountInfo && !accountExistError && !isCheckingAccount" class="mb-5">
    <div class="d-flex flex-center my-10 mb-5">
        <div class="symbol symbol-60px symbol-circle me-3">
          <p-avatar 
            [label]="getUserInitials(accountInfo.name)"
            styleClass="bg-light-info"
            size="large"
            [style]="{'font-size': '1.2rem', 'height': '40px', 'width': '40px'}">
          </p-avatar>
        </div>
        <div class="d-flex flex-column">
          <span class="fs-4 fw-bold text-gray-800 mb-0">{{ accountInfo.name }}</span>
          <span class="fs-6 fw-semibold text-muted">{{ accountInfo.email }}</span>
        </div>
      </div>
  </div>
  
  <!-- Account doesn't exist - show create form -->
  <div *ngIf="!accountExists && !accountExistError && !isCheckingAccount && emailForm.get('email')?.valid && emailForm.get('email')?.dirty && apiCheckCompleted" class="mb-5">
    <form [formGroup]="employeeForm">
      <!-- First Name -->
      <div class="mb-3">
        <label class="form-label required">First Name</label>
        <input 
          type="text" 
          class="form-control" 
          placeholder="Enter first name" 
          formControlName="firstName"
          pInputText
        />
        <!-- Validation messages -->
        <div *ngIf="employeeForm.get('firstName')?.touched && employeeForm.get('firstName')?.hasError('required')" class="fv-plugins-message-container">
          <div class="fv-help-block">First name is required</div>
        </div>
      </div>
      
      <!-- Last Name -->
      <div class="mb-3">
        <label class="form-label required">Last Name</label>
        <input 
          type="text" 
          class="form-control" 
          placeholder="Enter last name" 
          formControlName="lastName"
          pInputText
        />
        <!-- Validation messages -->
        <div *ngIf="employeeForm.get('lastName')?.touched && employeeForm.get('lastName')?.hasError('required')" class="fv-plugins-message-container">
          <div class="fv-help-block">Last name is required</div>
        </div>
      </div>
    </form>
  </div>
  
  <!-- Footer buttons -->
  <ng-template pTemplate="footer">
    <button 
      type="button"
      class="btn btn-light-primary me-3 btn-sm"
      (click)="closeAddEmployeeModal()"
      [disabled]="isInviting"
    >
      <i class="ki-duotone ki-cross fs-2"></i>
      Cancel
    </button>
    
    <button 
      type="button"
      class="btn btn-primary btn-sm"
      [disabled]="
        (accountExists && !accountInfo) || 
        (!accountExists && employeeForm.invalid) || 
        accountExistError !== null || 
        isCheckingAccount || 
        !emailForm.valid ||
        isInviting"
      (click)="inviteEmployee()"
    >
      <span *ngIf="isInviting" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
      <i *ngIf="!isInviting" class="ki-duotone ki-check fs-2"></i>
      {{ isInviting ? 'Inviting...' : 'Invite' }}
    </button>
  </ng-template>
</p-dialog>

