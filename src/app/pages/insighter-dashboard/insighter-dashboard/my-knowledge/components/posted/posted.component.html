<!--begin::Card-->
<div class="card card-flush">
  <!--begin::Card body-->
  <div class="card-body">
    <!--begin::Card header-->
    <div class="card-header p-0">
      <div class="card-title"  *ngIf="knowledges && knowledges.length > 0">
        <!--begin::Search-->
        <div class="d-flex align-items-center position-relative my-1">
          <i class="ki-outline ki-magnifier fs-1 position-absolute mx-2"></i>
          <input
            type="text"
            data-kt-filemanager-table-filter="search"
            class="form-control form-control-solid w-250px px-10"
            placeholder="{{ 'KNOWLEDGE.SEARCH_PLACEHOLDER' | translate }}"
            [(ngModel)]="searchTerm"
            (input)="onSearch($event)"
          />
        </div>
        <!--end::Search-->
      </div>

      <!--begin::Card toolbar-->
      <div class="card-toolbar" *ngIf="knowledges && knowledges.length > 0">
        <!--begin::Toolbar-->
        <div class="d-flex justify-content-end">
          <!--begin::Generate Package-->
          <!-- <button
            type="button"
            class="btn btn-sm btn-info"
            (click)="togglePackageBuilder()"
          >
            <i class="ki-outline ki-folder-up fs-2"></i> {{ showPackageBuilder ? ('KNOWLEDGE.CLOSE_PACKAGE_BUILDER' | translate) : ('KNOWLEDGE.GENERATE_PACKAGE' | translate) }}
          </button> -->
          <!--end::Generate Package-->
        </div>
        <!--end::Toolbar-->
      </div>
      <!--end::Card toolbar-->
    </div>
    <!--end::Card header-->

    <!--begin::Table header-->
    <div class="d-flex justify-content-end mb-6 pt-3" *ngIf="knowledges && knowledges.length > 0">
      <div class="d-flex gap-1">
        <!-- Add View Toggle -->
        <div class="nav-group nav-group-fluid ms-3">
          <label>
            <input
              type="radio"
              class="btn-check"
              name="type"
              value="grid"
              [(ngModel)]="selectedType"
              (change)="onTypeChange($event)"
              checked
            />
            <span
              class="radio h-30px fw-bold px-4"
              [class.radio-active]="selectedType === 'grid'"
            >
              <i
                class="ki-outline ki-element-11"
                [ngClass]="{
                  'text-gray-700': selectedType === 'grid',
                  'text-gray-500': selectedType !== 'grid'
                }"
              ></i>
            </span>
          </label>
          <label>
            <input
              type="radio"
              class="btn-check"
              name="type"
              value="list"
              [(ngModel)]="selectedType"
              (change)="onTypeChange($event)"
            />
            <span
              class="radio h-30px fw-bold px-4"
              [class.radio-active]="selectedType === 'list'"
            >
              <i
                class="ki-outline ki-row-horizontal"
                [ngClass]="{
                  'text-gray-700': selectedType === 'list',
                  'text-gray-500': selectedType !== 'list'
                }"
              ></i>
            </span>
          </label>
        </div>

        <!--begin::Items Counter-->
        <div class="badge badge-lg badge-primary">
          <span>{{ totalItems }} {{ 'KNOWLEDGE.ITEMS' | translate }}</span>
        </div>
      </div>
      <!--end::Items Counter-->
    </div>
    <!--end::Table header-->

    <div class="d-flex gap-4">
      <!-- Table Column -->
      <div [@columnResize]="showPackageBuilder ? 'w-65' : 'w-100'" 
           [class]="showPackageBuilder ? 'w-65' : 'w-100'">
        
        <!-- No Posted Items State -->
        <div *ngIf="knowledges && knowledges.length === 0 && !loading" class="text-center py-10 bg-light-secondary rounded">
          <i class="ki-outline ki-check-square fs-3x text-gray-500 mb-5"></i>
          <h3 class="fw-bold text-gray-800 mb-2">{{ 'MY_KNOWLEDGE.NO_POSTED.TITLE' | translate }}</h3>
          <p class="text-gray-600 fs-6">
            {{ searchTerm ? 
               ('MY_KNOWLEDGE.NO_POSTED.FILTERED_MESSAGE' | translate) : 
               ('MY_KNOWLEDGE.NO_POSTED.MESSAGE' | translate) }}
          </p>
        </div>
        
        <!-- Loading Indicator -->
        <div *ngIf="loading" class="d-flex justify-content-center my-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
            
        <!--begin::Table - List View-->
        <div class="table-responsive" *ngIf="knowledges && knowledges.length > 0 && selectedType === 'list' && !loading">
          <table class="table align-middle table-row-dashed fs-6 gy-5">
            <thead>
              <tr class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0">
                <th class="min-w-250px">{{ 'KNOWLEDGE.KNOWLEDGE_NAME' | translate }}</th>
                <th class="min-w-10px">{{ 'KNOWLEDGE.TYPE' | translate }}</th>
                <th class="min-w-125px">{{ 'KNOWLEDGE.TOTAL_PRICE' | translate }}</th>
                <th class="min-w-100px">{{ 'KNOWLEDGE.STATUS' | translate }}</th>
                <th class="w-125px" *ngIf="!showPackageBuilder"></th>
              </tr>
            </thead>
            <tbody class="fw-semibold text-gray-600">
              <tr *ngFor="let knowledge of knowledges; trackBy: trackById"
                  draggable="true"
                  (dragstart)="onDragStart($event, knowledge)"
                  (dragend)="onDragEnd($event)">
                <td>
                  <div class="d-flex align-items-center">
                    <a [routerLink]="['/app/my-knowledge-base/view-my-knowledge/', knowledge.id]" class="text-gray-800 text-hover-primary">{{ knowledge.title }}</a>
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <i *ngIf="knowledge.type === 'data'" class="fas fa-database text-primary mx-2 fs-6"></i>
                    <i *ngIf="knowledge.type === 'insight'" class="fas fa-lightbulb text-success mx-2 fs-6"></i>
                    <i *ngIf="knowledge.type === 'report'" class="fas fa-file-alt text-info mx-2 fs-6"></i>
                    <i *ngIf="knowledge.type === 'manual'" class="fas fa-book text-warning mx-2 fs-6"></i>
                    <i *ngIf="knowledge.type === 'course'" class="fas fa-graduation-cap text-success mx-2 fs-6"></i>
                    <i *ngIf="knowledge.type === 'media'" class="fas fa-play-circle text-danger mx-2 fs-6"></i>
                    {{ knowledge.type | titlecase }}
                  </div>
                </td>
                <td class="fw-bold text-gray-900">{{ knowledge.total_price | currency }}</td>
                <td>
                  <span class="badge badge-light-success">{{ knowledge.status | titlecase }}</span>
                </td>
                <td class="text-end" *ngIf="!showPackageBuilder">
                  <div class="d-flex justify-content-end">
                    <a [routerLink]="['/app/my-knowledge-base/view-my-knowledge/', knowledge.id]" 
                    class="btn btn-sm btn-icon btn-light btn-active-light-primary me-2"
                    ngbTooltip="{{ 'KNOWLEDGE.VIEW' | translate }}">
                      <i class="ki-duotone ki-eye fs-2">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                      </i>
                    </a>
                    <button type="button" 
                            class="btn btn-sm btn-icon btn-light btn-active-light-danger"
                            (click)="deleteKnowledge(knowledge)"
                            ngbTooltip="{{ 'KNOWLEDGE.DELETE' | translate }}">
                      <i class="ki-duotone ki-trash fs-5">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                        <span class="path4"></span>
                        <span class="path5"></span>
                      </i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!--end::Table-->

        <!-- Grid View -->
        <div class="row g-6 g-xl-9 mb-6 mb-xl-9" *ngIf="selectedType !== 'list' && knowledges && knowledges.length > 0 && !loading">
          <!-- Knowledge Cards -->
          <div class="col-md-6 col-lg-4 col-xl-3" *ngFor="let knowledge of knowledges; trackBy: trackById">
            <div class="card knowledge-card h-100 min-h-220px" draggable="true" (dragstart)="onDragStart($event, knowledge)" (dragend)="onDragEnd($event)">
              <div class="card-body">
                <!-- Title Section -->
                <div class="title-section">
                  <a [routerLink]="['/app/my-knowledge-base/view-my-knowledge/', knowledge.id]" 
                     class="knowledge-title text-hover-primary">{{ knowledge.title }}</a>
                </div>

                <!-- Type Badge -->
                <div class="type-badge">
                  <i *ngIf="knowledge.type === 'data'" class="ki-duotone ki-data text-primary">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                    <span class="path4"></span>
                    <span class="path5"></span>
                  </i>
                  <span *ngIf="knowledge.type === 'insight'" class="ki-duotone ki-bulb text-success">
                    <app-keenicon name="chart-line" class="fs-2 text-success"></app-keenicon>
                  </span>
                  <i *ngIf="knowledge.type === 'report'" class="ki-duotone ki-document text-info">
                    <span class="path1"></span>
                    <span class="path2"></span>
                  </i>
                  <i *ngIf="knowledge.type === 'manual'" class="ki-duotone ki-book text-warning">
                    <span class="path1"></span>
                    <span class="path2"></span>
                  </i>
                  <i *ngIf="knowledge.type === 'course'" class="ki-duotone ki-award text-success">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                    <span class="path4"></span>
                    <span class="path5"></span>
                  </i>
                  <i *ngIf="knowledge.type === 'media'" class="ki-duotone ki-play-circle text-danger">
                    <span class="path1"></span>
                    <span class="path2"></span>
                  </i>
                  <span>{{ knowledge.type | titlecase }}</span>
                </div>

                <!-- Price -->
                <div class="price">{{ knowledge.total_price | currency }}</div>

                <!-- Footer -->
                <div class="d-flex justify-content-between align-items-center">
                  <span class="badge badge-light-success text-capitalize">{{ knowledge.status }}</span>
                  
                  <div class="d-flex gap-2">
                    <a [routerLink]="['/app/my-knowledge-base/view-my-knowledge/', knowledge.id]" 
                       class="btn btn-sm btn-icon btn-light btn-active-light-primary"
                       ngbTooltip="{{ 'KNOWLEDGE.VIEW' | translate }}">
                      <i class="ki-duotone ki-eye">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                      </i>
                    </a>
                    <button type="button" 
                            class="btn btn-sm btn-icon btn-light btn-active-light-danger"
                            ngbTooltip="{{ 'KNOWLEDGE.DELETE' | translate }}"
                            (click)="deleteKnowledge(knowledge)">
                      <i class="ki-duotone ki-trash">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                        <span class="path4"></span>
                        <span class="path5"></span>
                      </i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--begin::Pagination-->
        <div class="d-flex justify-content-end mt-6" *ngIf="knowledges && knowledges.length > 0 && !loading">
          <ul class="pagination">
            <!-- Previous Button -->
            <li class="page-item" [ngClass]="{'disabled': currentPage === 1}">
              <a class="page-link cursor-pointer" (click)="currentPage > 1 && loadPage(currentPage - 1)">
                <i class="previous"></i>
              </a>
            </li>
        
            <!-- Page Numbers -->
            <li class="page-item"
                *ngFor="let page of getPages(); trackBy: trackByIndex"
                [ngClass]="{'active': page === currentPage, 'disabled': page === '...'}">
              <a class="page-link cursor-pointer"
                 (click)="onPageClick(page)">
                {{ page }}
              </a>
            </li>
        
            <!-- Next Button -->
            <li class="page-item" [ngClass]="{'disabled': currentPage === totalPages}">
              <a class="page-link cursor-pointer" (click)="currentPage < totalPages && loadPage(currentPage + 1)">
                <i class="next"></i>
              </a>
            </li>
          </ul>
        </div>
        <!--end::Pagination-->
      </div>

      <!-- Package Sidebar -->
      <div class="w-35 package-sidebar position-sticky" 
           *ngIf="showPackageBuilder && !isSmallScreen" 
           [@slideInOut]
           style="top: 200px; height: calc(100vh - 100px); overflow-y: auto;">
        <div class="card">
          <div class="card-body">
            <app-package-builder-content
              [packageName]="packageName"
              [(packages)]="packages"
              [(discount)]="discount"
              [allKnowledges]="allKnowledges"
              [(selectedKnowledge)]="selectedKnowledge"
              [showDragDrop]="true"
              [loading]="loading"
              (savePackage)="showEmittedPackage($event)"
              (onKnowledgeSelect)="onKnowledgeSelect($event)">
            </app-package-builder-content>
          </div>
        </div>
      </div>

      <!-- Package Builder Dialog for small screens -->
      <p-dialog 
        [(visible)]="showDialog" 
        [modal]="true"
        [style]="{width: '90vw', maxWidth: '800px'}"
        [contentStyle]="{overflow: 'visible'}"
        [maximizable]="true"
        [draggable]="false" 
        [resizable]="false"
        *ngIf="isSmallScreen && showPackageBuilder">
        <app-package-builder-content
          [packageName]="packageName"
          [(packages)]="packages"
          [(discount)]="discount"
          [allKnowledges]="allKnowledges"
          [(selectedKnowledge)]="selectedKnowledge"
          [showDragDrop]="false"
          [loading]="loading"
          (savePackage)="showEmittedPackage($event)"
          (onKnowledgeSelect)="onKnowledgeSelect($event)">
        </app-package-builder-content>
      </p-dialog>
    </div>
  </div>
  <!--end::Card body-->
</div>
<!--end::Card-->