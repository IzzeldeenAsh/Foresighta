
<div class="container-fluid bg-white p-5 rounded-lg" style="border-radius: 10px;">
  <!-- Tab Navigation -->
  <div class="row mb-2">
    <div class="col-md-6 col-lg-8">
      <div class="filter-tabs-orders">
          <div class="nav nav-pills nav-pills-custom">
            <a class="nav-link"
              [class.active]="activeTab === 'knowledge'"
              (click)="setActiveTab('knowledge')">
              <span class="nav-svg me-2">
                <svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1.36533 4.13696H3.47275C3.82072 4.13721 4.10355 4.42078 4.10361 4.7688V13.4075C4.10338 13.7553 3.82061 14.0381 3.47275 14.0383H1.36533C1.0173 14.0383 0.733722 13.7555 0.73349 13.4075V4.7688C0.733543 4.42066 1.01719 4.13702 1.36533 4.13696Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M2.41922 5.40137C2.53509 5.40157 2.62918 5.49639 2.62918 5.6123V11.3008C2.62901 11.4166 2.53498 11.5105 2.41922 11.5107C2.30328 11.5107 2.20845 11.4167 2.20828 11.3008V5.6123C2.20828 5.49626 2.30318 5.40137 2.41922 5.40137Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M2.10324 12.3542H2.73508C2.85105 12.3543 2.94504 12.4492 2.94504 12.5652C2.94483 12.681 2.85092 12.7751 2.73508 12.7751H2.10324C1.98733 12.7751 1.89251 12.6811 1.8923 12.5652C1.8923 12.4491 1.9872 12.3542 2.10324 12.3542Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M4.9346 4.13696H7.04202C7.39 4.13721 7.67283 4.42078 7.67288 4.7688V13.4075C7.67265 13.7553 7.38989 14.0381 7.04202 14.0383H4.9346C4.58657 14.0383 4.303 13.7555 4.30276 13.4075V4.7688C4.30282 4.42066 4.58646 4.13702 4.9346 4.13696Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M5.98853 5.40137C6.10439 5.40157 6.19849 5.49639 6.19849 5.6123V11.3008C6.19831 11.4166 6.10429 11.5105 5.98853 11.5107C5.87259 11.5107 5.77776 11.4167 5.77759 11.3008V5.6123C5.77759 5.49626 5.87248 5.40137 5.98853 5.40137Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M5.67249 12.3542H6.30432C6.42029 12.3543 6.51428 12.4492 6.51428 12.5652C6.51408 12.681 6.42017 12.7751 6.30432 12.7751H5.67249C5.55657 12.7751 5.46175 12.6811 5.46155 12.5652C5.46155 12.4491 5.55644 12.3542 5.67249 12.3542Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M8.28717 4.26361L10.3264 3.73168C10.6631 3.64409 11.0084 3.84709 11.0963 4.18383L13.2767 12.5428C13.3643 12.8795 13.1621 13.2244 12.8255 13.3125L10.7863 13.8444C10.4496 13.9322 10.1038 13.7301 10.0157 13.3934L7.83527 5.03447C7.74745 4.69759 7.95032 4.35153 8.28717 4.26361Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M9.62609 5.22092C9.73825 5.19187 9.85323 5.25987 9.88249 5.37203L11.3183 10.8763C11.3474 10.9884 11.2801 11.1031 11.1681 11.1325C11.056 11.1617 10.9404 11.0947 10.911 10.9826L9.47522 5.47827C9.44593 5.36599 9.5138 5.25021 9.62609 5.22092Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M11.0751 12.0281L11.6865 11.8686C11.7987 11.8394 11.9136 11.9074 11.9429 12.0197C11.9719 12.1318 11.9048 12.2465 11.7927 12.2758L11.1814 12.4353C11.0692 12.4646 10.9537 12.3975 10.9243 12.2854C10.895 12.1731 10.9628 12.0573 11.0751 12.0281Z" stroke="#A6A5A5" stroke-width="0.211513"/>
                  <path d="M6.24203 1.34692H8.63754C8.6776 1.34695 8.71274 1.38205 8.71274 1.42212C8.71272 1.46217 8.67759 1.49729 8.63754 1.49731H6.24203C6.20196 1.49731 6.16686 1.46219 6.16684 1.42212C6.16684 1.38204 6.20195 1.34692 6.24203 1.34692Z" fill="#3799FF" stroke="#A6A5A5" stroke-width="0.299437"/>
                  <path d="M7.43979 0.149414C7.47986 0.149432 7.51498 0.184538 7.51498 0.224609V2.62012C7.51496 2.66017 7.47984 2.69529 7.43979 2.69531C7.39972 2.69531 7.36462 2.66018 7.36459 2.62012V0.224609C7.36459 0.184528 7.39971 0.149414 7.43979 0.149414Z" fill="#3799FF" stroke="#A6A5A5" stroke-width="0.299437"/>
                  </svg>
                  
              </span>
              {{ lang === 'ar' ? 'بيانات وتقارير' : 'Data and Reports' }}
            </a>
            <a class="nav-link"
              [class.active]="activeTab === 'meeting'"
              (click)="setActiveTab('meeting')">
              <span class="nav-svg me-2">
                <i class="ki-outline ki-calendar"></i>
              </span>
              {{ lang === 'ar' ? "اجتماعات" : 'Meetings' }}
            </a>
          </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4 d-flex justify-content-end align-items-center" *ngIf="canViewSalesTabs">
      <!-- Statistics Cards -->
      <div class="d-flex gap-3" *ngIf="orderStatisticsService.statistics$ | async as stats; else loadingSpinnerHeader">
        <!-- Purchased Card -->
        <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
          <div class="symbol symbol-40px me-2">
            <div class="symbol-label bg-light-primary">
              <i class="ki-outline ki-basket text-primary fs-5"></i>
            </div>
          </div>
          <div class="d-flex flex-column">
            <span class="text-gray-800 fw-bold fs-6">
              <ng-container *ngIf="activeTab === 'knowledge'">
                ${{ stats?.knowledge_purchased_amount || 0 }}
              </ng-container>
              <ng-container *ngIf="activeTab === 'meeting'">
                ${{ stats?.meeting_purchased_amount || 0 }}
              </ng-container>
            </span>
            <span class="text-muted fw-semibold fs-8">
              {{ lang === 'ar' ? 'مشترى' : 'Purchased' }}
            </span>
          </div>
        </div>

        <!-- Sold Card -->
        <!-- <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
          <div class="symbol symbol-40px me-2">
            <div class="symbol-label bg-light-success">
              <i class="ki-outline ki-dollar text-success fs-5"></i>
            </div>
          </div>
          <div class="d-flex flex-column">
            <span class="text-gray-800 fw-bold fs-6">
              <ng-container *ngIf="activeTab === 'knowledge'">
                ${{ stats?.knowledge_sold_amount || 0 }}
              </ng-container>
              <ng-container *ngIf="activeTab === 'meeting'">
                ${{ stats?.meeting_sold_amount || 0 }}
              </ng-container>
            </span>
            <span class="text-muted fw-semibold fs-8">
              {{ lang === 'ar' ? 'مباع' : 'Sold' }}
            </span>
          </div>
        </div> -->
      </div>

      <ng-template #loadingSpinnerHeader>
        <div class="d-flex gap-3">
          <!-- Loading Purchased Card -->
          <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
            <div class="symbol symbol-40px me-2">
              <div class="symbol-label bg-light-primary">
                <i class="ki-outline ki-basket text-primary fs-5"></i>
              </div>
            </div>
            <div class="d-flex flex-column">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span class="text-muted fw-semibold fs-8">
                {{ lang === 'ar' ? 'مشترى' : 'Purchased' }}
              </span>
            </div>
          </div>

          <!-- Loading Sold Card -->
          <!-- <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
            <div class="symbol symbol-40px me-2">
              <div class="symbol-label bg-light-success">
                <i class="ki-outline ki-dollar text-success fs-5"></i>
              </div>
            </div>
            <div class="d-flex flex-column">
              <div class="spinner-border spinner-border-sm text-success" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span class="text-muted fw-semibold fs-8">
                {{ lang === 'ar' ? 'مباع' : 'Sold' }}
              </span>
            </div>
          </div> -->
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Knowledge Orders Tab -->
  <ng-container *ngIf="activeTab === 'knowledge'">
    <app-knowledge-orders
      [lang]="currentLang"
      [orders$]="orders$"
      [totalPages$]="totalPages$"
      [currentPage]="currentPage"
      [isLoading$]="isLoading$"
      (pageChange)="onPageChange($event)"
      (orderSelected)="openOrderDetails($event)"
      (invoiceDownload)="downloadInvoice($event)"
      (navigateToDownloads)="navigateToDownloads($event)"
      (copyOrderNo)="copyOrderNo($event)">
    </app-knowledge-orders>
  </ng-container>

<!-- Meeting Orders Tab -->
  <ng-container *ngIf="activeTab === 'meeting'">
    <app-meeting-orders
      [lang]="currentLang"
      [meetingOrders$]="meetingOrders$"
      [meetingTotalPages$]="meetingTotalPages$"
      [currentMeetingPage]="currentMeetingPage"
      [isMeetingLoading$]="isMeetingLoading$"
      (meetingPageChange)="onMeetingPageChange($event)"
      (meetingOrderSelected)="openMeetingOrderDetails($event)"
      (invoiceDownload)="downloadInvoice($event)"
      (copyOrderNo)="copyOrderNo($event)">
    </app-meeting-orders>
  </ng-container>

<!-- Order Details Dialog -->
<app-order-details-dialog
  [(visible)]="showOrderDetails"
  [lang]="currentLang"
  [order]="selectedOrder">
</app-order-details-dialog>

<!-- Meeting Order Details Dialog -->
<app-meeting-order-details-dialog
  [(visible)]="showMeetingOrderDetails"
  [lang]="currentLang"
  [order]="selectedMeetingOrder">
</app-meeting-order-details-dialog>
