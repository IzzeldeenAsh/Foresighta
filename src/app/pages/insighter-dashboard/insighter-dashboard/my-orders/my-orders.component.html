
<div class="container-fluid bg-white p-5 rounded-lg" style="border-radius: 10px;">
  <!-- Tab Navigation -->
  <div class="row mb-10">
    <div class="col-md-6 col-lg-8">
      <div class="filter-tabs-orders">
          <div class="nav nav-pills nav-pills-custom">
            <a class="nav-link"
              [class.active]="activeTab === 'knowledge'"
              (click)="setActiveTab('knowledge')">
              <span class="nav-svg me-2">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3.52799 4.67989L6.28319 5.38069H6.32159C6.35814 5.38175 6.39395 5.37027 6.42306 5.34814C6.45218 5.32602 6.47283 5.29459 6.48159 5.25909C6.48686 5.2386 6.488 5.21727 6.48497 5.19633C6.48194 5.17539 6.47479 5.15527 6.46392 5.13711C6.45306 5.11896 6.43871 5.10314 6.42169 5.09057C6.40468 5.078 6.38534 5.06893 6.36479 5.06389L3.60639 4.36789C3.58591 4.36274 3.56461 4.36168 3.54371 4.36476C3.52281 4.36784 3.50273 4.37501 3.4846 4.38586C3.46648 4.39671 3.45066 4.41102 3.43807 4.42797C3.42547 4.44493 3.41634 4.4642 3.41119 4.48469C3.40604 4.50517 3.40498 4.52647 3.40806 4.54737C3.41115 4.56827 3.41832 4.58835 3.42916 4.60648C3.44001 4.6246 3.45432 4.64042 3.47128 4.65301C3.48823 4.66561 3.5075 4.67474 3.52799 4.67989Z" fill="#A6A5A5"/>
                  <path d="M6.36158 5.84313L3.60638 5.14233C3.586 5.13718 3.5648 5.13609 3.544 5.13914C3.5232 5.14218 3.50321 5.14929 3.48515 5.16006C3.4671 5.17084 3.45135 5.18506 3.43879 5.20192C3.42624 5.21878 3.41713 5.23794 3.41198 5.25833C3.40683 5.27871 3.40575 5.2999 3.40879 5.3207C3.41183 5.3415 3.41895 5.3615 3.42972 5.37955C3.44049 5.3976 3.45471 5.41335 3.47157 5.42591C3.48843 5.43847 3.5076 5.44758 3.52798 5.45273L6.28318 6.15353H6.32158C6.36401 6.15883 6.40682 6.14706 6.44057 6.1208C6.47433 6.09455 6.49627 6.05596 6.50158 6.01353C6.50688 5.97109 6.49511 5.92829 6.46886 5.89453C6.4426 5.86077 6.40401 5.83883 6.36158 5.83353V5.84313Z" fill="#A6A5A5"/>
                  <path d="M2.02718 9.59989H2.23038L2.78238 12.9599L2.26878 13.4719C2.12695 13.6152 2.04118 13.8046 2.02702 14.0058C2.01287 14.207 2.07128 14.4065 2.19165 14.5683C2.31202 14.7301 2.48638 14.8434 2.68312 14.8876C2.87986 14.9319 3.08593 14.9042 3.26398 14.8095C3.37168 14.9322 3.50432 15.0305 3.65304 15.0978C3.80176 15.1651 3.96314 15.1999 4.12638 15.1999H11.8736C12.146 15.2012 12.4099 15.1052 12.6179 14.9292C12.8258 14.7532 12.9642 14.5088 13.008 14.2399L13.7696 9.59989H13.9728C14.1336 9.59989 14.2879 9.536 14.4016 9.42228C14.5153 9.30856 14.5792 9.15432 14.5792 8.99349V8.15989C14.5792 7.99906 14.5153 7.84482 14.4016 7.7311C14.2879 7.61738 14.1336 7.55349 13.9728 7.55349H13.6V3.03029C13.6 2.91082 13.5728 2.79293 13.5203 2.68561C13.4678 2.57828 13.3915 2.48437 13.2972 2.41105C13.2029 2.33773 13.093 2.28693 12.9761 2.26253C12.8591 2.23814 12.7382 2.24079 12.6224 2.27029L12.48 2.30389V1.81109C12.4804 1.72102 12.4575 1.63236 12.4135 1.55376C12.3696 1.47516 12.306 1.4093 12.2289 1.36257C12.1519 1.31585 12.0641 1.28987 11.9741 1.28716C11.8841 1.28444 11.7949 1.30509 11.7152 1.34709L11.2352 1.60149V1.25909C11.235 1.16949 11.2085 1.08192 11.1592 1.00716C11.1098 0.932395 11.0396 0.873711 10.9573 0.838335C10.875 0.802959 10.7841 0.792437 10.6959 0.808066C10.6077 0.823694 10.5259 0.86479 10.4608 0.92629L7.99998 3.24309L5.54718 0.92629C5.48203 0.86479 5.40031 0.823694 5.31208 0.808066C5.22386 0.792437 5.13299 0.802959 5.05067 0.838335C4.96836 0.873711 4.89819 0.932395 4.84881 1.00716C4.79943 1.08192 4.77301 1.16949 4.77278 1.25909V1.59989L4.38558 1.39829C4.29561 1.35139 4.19508 1.32841 4.09366 1.33155C3.99225 1.33469 3.89334 1.36384 3.80643 1.41621C3.71952 1.46858 3.64753 1.54241 3.59737 1.63061C3.54721 1.71881 3.52056 1.81843 3.51998 1.91989V2.30389L3.38238 2.27029C3.2663 2.23993 3.1448 2.23661 3.02723 2.2606C2.90966 2.28459 2.79917 2.33525 2.70426 2.40867C2.60936 2.48209 2.53257 2.57632 2.47982 2.68409C2.42706 2.79186 2.39975 2.9103 2.39998 3.03029V7.55029H2.02718C1.94728 7.55029 1.86817 7.56608 1.79438 7.59675C1.7206 7.62743 1.65361 7.67238 1.59726 7.72903C1.54091 7.78568 1.49631 7.85291 1.46602 7.92685C1.43574 8.00079 1.42036 8.07999 1.42078 8.15989V8.99669C1.42163 9.15696 1.48589 9.31038 1.59952 9.42341C1.71315 9.53644 1.86691 9.59989 2.02718 9.59989ZM2.55998 9.59989H6.14078L5.09598 10.6463C5.06405 10.4943 4.97322 10.3612 4.84339 10.2761C4.71356 10.1909 4.55528 10.1606 4.40318 10.1919H4.37758C4.22635 10.2235 4.09367 10.3135 4.00831 10.4423C3.92295 10.571 3.89179 10.7283 3.92158 10.8799L4.08158 11.6527L3.05918 12.6751L2.55998 9.59989ZM4.35358 11.3871L4.23518 10.8207C4.22766 10.7861 4.22704 10.7504 4.23335 10.7156C4.23966 10.6808 4.25278 10.6476 4.27195 10.6178C4.29113 10.5881 4.31598 10.5625 4.34509 10.5424C4.3742 10.5223 4.40699 10.5081 4.44158 10.5007H4.46558C4.50018 10.4927 4.53602 10.4918 4.57099 10.4979C4.60595 10.504 4.63934 10.5171 4.66917 10.5363C4.699 10.5556 4.72468 10.5806 4.74467 10.6099C4.76467 10.6392 4.77858 10.6723 4.78558 10.7071L4.82878 10.9167L4.35358 11.3871ZM2.49598 14.4383C2.44732 14.3898 2.4087 14.3322 2.38235 14.2688C2.356 14.2054 2.34244 14.1374 2.34244 14.0687C2.34244 14 2.356 13.932 2.38235 13.8686C2.4087 13.8052 2.44732 13.7476 2.49598 13.6991L4.37118 11.8223L5.11998 11.0815L6.64798 9.55509L7.45918 8.74229C7.50689 8.69019 7.56466 8.64828 7.629 8.61911C7.69334 8.58994 7.76292 8.57409 7.83355 8.57254C7.90418 8.57099 7.97439 8.58375 8.03995 8.61007C8.10551 8.63638 8.16507 8.6757 8.21502 8.72565C8.26497 8.77561 8.30429 8.83516 8.33061 8.90072C8.35692 8.96629 8.36969 9.0365 8.36814 9.10713C8.36658 9.17775 8.35074 9.24734 8.32156 9.31168C8.29239 9.37602 8.25049 9.43378 8.19838 9.48149L5.22238 12.4575L4.47998 13.1951L3.23838 14.4383C3.18976 14.4872 3.13192 14.5261 3.06822 14.5526C3.00451 14.5791 2.93619 14.5928 2.86718 14.5928C2.79818 14.5928 2.72986 14.5791 2.66615 14.5526C2.60245 14.5261 2.54461 14.4872 2.49598 14.4383ZM7.32318 13.5631C7.32988 13.6331 7.30854 13.7029 7.26385 13.7572C7.21916 13.8115 7.15476 13.8458 7.08478 13.8527H7.05918C7.02461 13.856 6.98971 13.8525 6.95648 13.8424C6.92326 13.8322 6.89237 13.8156 6.86558 13.7935C6.8114 13.7479 6.77698 13.6831 6.76958 13.6127L6.57598 11.5487L7.08638 11.0399L7.32318 13.5631ZM5.36958 13.5311C5.38351 13.6002 5.36972 13.672 5.33118 13.7311C5.31194 13.7604 5.28701 13.7855 5.25788 13.8051C5.22875 13.8246 5.19601 13.838 5.16158 13.8447H5.13918C5.10469 13.8529 5.0689 13.8541 5.03394 13.8482C4.99898 13.8423 4.96557 13.8294 4.9357 13.8102C4.90583 13.7911 4.88013 13.7662 4.86011 13.7369C4.84009 13.7077 4.82617 13.6747 4.81918 13.6399L4.75838 13.3551L5.22878 12.8847L5.36958 13.5311ZM12.6912 14.1839C12.6603 14.3783 12.5609 14.5553 12.411 14.683C12.2611 14.8106 12.0705 14.8804 11.8736 14.8799H4.12638C4.01208 14.8793 3.89914 14.855 3.79474 14.8085C3.69035 14.7619 3.59678 14.6942 3.51998 14.6095L4.49918 13.6303L4.51518 13.7103C4.54306 13.842 4.61533 13.9601 4.7199 14.0449C4.82447 14.1296 4.95498 14.1759 5.08958 14.1759C5.13047 14.1763 5.17128 14.172 5.21118 14.1631H5.23358C5.30893 14.1475 5.38045 14.1172 5.44407 14.0739C5.50769 14.0306 5.56216 13.9752 5.60436 13.9109C5.64656 13.8465 5.67566 13.7745 5.69001 13.6989C5.70436 13.6233 5.70367 13.5456 5.68798 13.4703L5.51198 12.6239L6.28158 11.8399L6.45118 13.6415C6.46406 13.7883 6.53184 13.9249 6.64098 14.0239C6.75012 14.123 6.8926 14.1773 7.03998 14.1759H7.09598H7.12158C7.27642 14.1609 7.41897 14.0851 7.51797 13.9651C7.61696 13.8451 7.6643 13.6907 7.64958 13.5359L7.38078 10.7439L8.42078 9.70549C8.45229 9.67216 8.48168 9.63689 8.50878 9.59989H13.44L12.6912 14.1839ZM12.6912 2.58069C12.7595 2.56325 12.831 2.56168 12.9 2.5761C12.9691 2.59052 13.0339 2.62055 13.0896 2.66389C13.1478 2.70577 13.1954 2.76075 13.2285 2.82439C13.2615 2.88804 13.2792 2.95857 13.28 3.03029V7.55029H8.69918V3.59669L9.11998 3.48949V5.14229C9.12021 5.23641 9.14704 5.32855 9.19738 5.40808C9.24772 5.48761 9.31952 5.55129 9.40449 5.59177C9.48946 5.63224 9.58415 5.64788 9.67762 5.63686C9.7711 5.62584 9.85955 5.58862 9.93278 5.52949L10.1552 5.35029L10.3776 5.52949C10.4504 5.59228 10.5399 5.63262 10.6352 5.64563C10.7304 5.65864 10.8275 5.64377 10.9145 5.60281C11.0015 5.56184 11.0747 5.49655 11.1254 5.41482C11.1761 5.33309 11.202 5.23843 11.2 5.14229V2.96309L12.3568 2.66869L12.6912 2.58069ZM7.62078 7.55029V3.63349H8.37918V7.55029H7.62078ZM9.43998 3.40789L10.88 3.03989V5.14229C10.8799 5.17584 10.8704 5.20869 10.8525 5.23704C10.8345 5.26539 10.8089 5.28807 10.7786 5.30247C10.7483 5.31687 10.7145 5.32239 10.6812 5.31839C10.6479 5.3144 10.6164 5.30105 10.5904 5.27989L10.2704 5.01909C10.2419 4.99597 10.2063 4.98335 10.1696 4.98335C10.1329 4.98335 10.0973 4.99597 10.0688 5.01909L9.74878 5.27989C9.72292 5.30123 9.69149 5.31474 9.65821 5.31882C9.62492 5.32291 9.59116 5.3174 9.5609 5.30294C9.53064 5.28848 9.50514 5.26568 9.48741 5.23722C9.46967 5.20876 9.46043 5.17582 9.46078 5.14229L9.43998 3.40789ZM11.856 1.63189C11.8871 1.61411 11.9223 1.60488 11.9582 1.60512C11.994 1.60536 12.0291 1.61507 12.06 1.63327C12.0909 1.65146 12.1164 1.67749 12.1339 1.70872C12.1515 1.73995 12.1605 1.77527 12.16 1.81109V2.38709L8.75358 3.25269L11.856 1.63189ZM10.6736 1.15989C10.6931 1.14151 10.7175 1.12922 10.7439 1.12453C10.7703 1.11983 10.7974 1.12295 10.8221 1.13348C10.8467 1.14401 10.8677 1.16151 10.8826 1.18383C10.8974 1.20614 10.9054 1.2323 10.9056 1.25909V1.76789L8.94878 2.78869L10.6736 1.15989ZM5.09438 1.25909C5.09456 1.2323 5.10256 1.20614 5.11739 1.18383C5.13222 1.16151 5.15325 1.14401 5.17788 1.13348C5.20252 1.12295 5.2297 1.11983 5.25608 1.12453C5.28246 1.12922 5.30689 1.14151 5.32638 1.15989L7.05118 2.78869L5.09438 1.76789V1.25909ZM3.83998 1.91989C3.8395 1.87325 3.85117 1.82728 3.87383 1.78651C3.89649 1.74574 3.92937 1.71157 3.96924 1.68736C4.00911 1.66315 4.0546 1.64972 4.10123 1.64842C4.14785 1.64711 4.19402 1.65795 4.23518 1.67989L7.24478 3.24949L3.83998 2.38549V1.91989ZM2.71998 3.02709C2.71949 2.95632 2.73541 2.8864 2.7665 2.82282C2.7976 2.75924 2.84302 2.70375 2.89918 2.66069C2.95485 2.61735 3.01968 2.58732 3.08874 2.5729C3.15779 2.55848 3.22923 2.56005 3.29758 2.57749L3.64158 2.66549L7.29278 3.59349V7.55029H2.71998V3.02709ZM1.74238 8.15989C1.74238 8.08421 1.77234 8.0116 1.8257 7.95794C1.87907 7.90427 1.9515 7.87391 2.02718 7.87349H13.9728C14.0485 7.87391 14.1209 7.90427 14.1743 7.95794C14.2276 8.0116 14.2576 8.08421 14.2576 8.15989V8.99669C14.2572 9.07195 14.227 9.14398 14.1736 9.19704C14.1202 9.25011 14.048 9.27989 13.9728 9.27989H8.64958C8.67474 9.15736 8.67233 9.03077 8.64251 8.90929C8.61269 8.78781 8.55622 8.67448 8.47718 8.57753C8.39815 8.48057 8.29853 8.40241 8.18556 8.34872C8.07258 8.29503 7.94907 8.26714 7.82398 8.26709C7.71325 8.26665 7.60355 8.28837 7.50133 8.33096C7.39911 8.37355 7.30645 8.43616 7.22878 8.51509L6.46238 9.27989H2.02718C1.95165 9.27989 1.87921 9.24988 1.8258 9.19647C1.77239 9.14306 1.74238 9.07062 1.74238 8.99509V8.15989Z" fill="#A6A5A5"/>
                  <path d="M8.35679 13.5327C8.34208 13.6876 8.38942 13.8419 8.48841 13.9619C8.5874 14.0819 8.72996 14.1577 8.88479 14.1727H8.91039H8.95999C9.10577 14.1725 9.24624 14.118 9.35395 14.0198C9.46165 13.9215 9.52885 13.7867 9.54239 13.6415L9.81279 10.7615C9.8275 10.6067 9.78016 10.4523 9.68117 10.3323C9.58218 10.2123 9.43962 10.1365 9.28479 10.1215H9.25919C9.18239 10.1142 9.10491 10.1222 9.03117 10.1448C8.95743 10.1675 8.88889 10.2045 8.82945 10.2537C8.77002 10.3029 8.72086 10.3633 8.68478 10.4315C8.6487 10.4997 8.62641 10.5743 8.61919 10.6511L8.35679 13.5327ZM8.67679 13.5631L8.94719 10.6831C8.95317 10.6172 8.98356 10.5559 9.03239 10.5112C9.08123 10.4665 9.14499 10.4416 9.21119 10.4415H9.23519H9.26079C9.29545 10.4445 9.32917 10.4544 9.35998 10.4705C9.39079 10.4867 9.41809 10.5088 9.44027 10.5356C9.46246 10.5624 9.47909 10.5934 9.4892 10.6266C9.49932 10.6599 9.50271 10.6949 9.49919 10.7295L9.23039 13.6095C9.22299 13.6799 9.18858 13.7447 9.13439 13.7903C9.1076 13.8124 9.07671 13.8291 9.04349 13.8392C9.01027 13.8494 8.97537 13.8529 8.94079 13.8495H8.91519C8.84582 13.8426 8.78194 13.8087 8.73734 13.7551C8.69273 13.7016 8.67099 13.6326 8.67679 13.5631Z" fill="#A6A5A5"/>
                  <path d="M10.7696 14.1583H10.7952C10.8347 14.1658 10.8749 14.1695 10.9152 14.1695C11.0498 14.1694 11.1803 14.1232 11.2849 14.0384C11.3894 13.9537 11.4617 13.8355 11.4896 13.7039L11.7696 12.3583L12.0784 10.8799C12.1096 10.7278 12.0794 10.5695 11.9942 10.4397C11.909 10.3098 11.7759 10.219 11.624 10.1871H11.5984C11.4463 10.1558 11.288 10.1861 11.1582 10.2712C11.0283 10.3564 10.9375 10.4895 10.9056 10.6415L10.3168 13.4655C10.2851 13.6174 10.3149 13.7757 10.3998 13.9056C10.4847 14.0355 10.6177 14.1263 10.7696 14.1583ZM10.6304 13.5311L11.2192 10.7071C11.2317 10.6472 11.2645 10.5935 11.312 10.5551C11.3595 10.5166 11.4188 10.4957 11.48 10.4959H11.5344H11.5584C11.593 10.5033 11.6258 10.5174 11.6549 10.5375C11.684 10.5576 11.7088 10.5833 11.728 10.613C11.7472 10.6427 11.7603 10.676 11.7666 10.7108C11.7729 10.7456 11.7723 10.7813 11.7648 10.8159L11.456 12.2991L11.1744 13.6447C11.1674 13.6794 11.1535 13.7124 11.1335 13.7417C11.1134 13.771 11.0877 13.7959 11.0579 13.815C11.028 13.8341 10.9946 13.847 10.9596 13.8529C10.9247 13.8589 10.8889 13.8577 10.8544 13.8495H10.8288C10.7628 13.8336 10.7055 13.7929 10.6688 13.7359C10.6491 13.706 10.6355 13.6725 10.6289 13.6373C10.6223 13.6022 10.6228 13.566 10.6304 13.5311Z" fill="#A6A5A5"/>
                  </svg>

              </span>
              {{ lang === 'ar' ? 'طلبات المعرفة' : 'Knowledge Orders' }}
            </a>
            <a class="nav-link"
              [class.active]="activeTab === 'meeting'"
              (click)="setActiveTab('meeting')">
              <span class="nav-svg me-2">
                <i class="ki-outline ki-calendar"></i>
              </span>
              {{ lang === 'ar' ? 'طلبات الاجتماعات' : 'Meeting Orders' }}
            </a>
          </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4 d-flex justify-content-end align-items-center">
      <!-- Statistics Cards -->
      <div class="d-flex gap-3" *ngIf="orderStatisticsService.statistics$ | async as stats; else loadingSpinnerHeader">
        <!-- Purchased Card -->
        <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
          <div class="symbol symbol-40px me-2">
            <div class="symbol-label bg-light-primary">
              <i class="ki-outline ki-basket text-primary fs-5"></i>
            </div>
          </div>
          <div class="d-flex flex-column">
            <span class="text-gray-800 fw-bold fs-6">
              <ng-container *ngIf="activeTab === 'knowledge'">
                ${{ stats?.knowledge_purchased_amount || 0 }}
              </ng-container>
              <ng-container *ngIf="activeTab === 'meeting'">
                ${{ stats?.meeting_purchased_amount || 0 }}
              </ng-container>
            </span>
            <span class="text-muted fw-semibold fs-8">
              {{ lang === 'ar' ? 'مشترى' : 'Purchased' }}
            </span>
          </div>
        </div>

        <!-- Sold Card -->
        <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
          <div class="symbol symbol-40px me-2">
            <div class="symbol-label bg-light-success">
              <i class="ki-outline ki-dollar text-success fs-5"></i>
            </div>
          </div>
          <div class="d-flex flex-column">
            <span class="text-gray-800 fw-bold fs-6">
              <ng-container *ngIf="activeTab === 'knowledge'">
                ${{ stats?.knowledge_sold_amount || 0 }}
              </ng-container>
              <ng-container *ngIf="activeTab === 'meeting'">
                ${{ stats?.meeting_sold_amount || 0 }}
              </ng-container>
            </span>
            <span class="text-muted fw-semibold fs-8">
              {{ lang === 'ar' ? 'مباع' : 'Sold' }}
            </span>
          </div>
        </div>
      </div>

      <ng-template #loadingSpinnerHeader>
        <div class="d-flex gap-3">
          <!-- Loading Purchased Card -->
          <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
            <div class="symbol symbol-40px me-2">
              <div class="symbol-label bg-light-primary">
                <i class="ki-outline ki-basket text-primary fs-5"></i>
              </div>
            </div>
            <div class="d-flex flex-column">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span class="text-muted fw-semibold fs-8">
                {{ lang === 'ar' ? 'مشترى' : 'Purchased' }}
              </span>
            </div>
          </div>

          <!-- Loading Sold Card -->
          <div class="d-flex align-items-center border rounded-3 p-3" style="border-color: #e4e6ef !important; min-width: 160px;">
            <div class="symbol symbol-40px me-2">
              <div class="symbol-label bg-light-success">
                <i class="ki-outline ki-dollar text-success fs-5"></i>
              </div>
            </div>
            <div class="d-flex flex-column">
              <div class="spinner-border spinner-border-sm text-success" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span class="text-muted fw-semibold fs-8">
                {{ lang === 'ar' ? 'مباع' : 'Sold' }}
              </span>
            </div>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Knowledge Orders Tab -->
  <div *ngIf="activeTab === 'knowledge'">
    <div class="row mb-0" *ngIf="canViewSalesTabs">
      <div class="col-12">
        <div class="nested-tab-nav">
          <button
            type="button"
            class="nested-tab-button"
            [ngClass]="{ 'active': knowledgeSubTab === 'purchased' }"
            (click)="setKnowledgeSubTab('purchased')">
            {{ lang === 'ar' ? 'الطلبات المشتراة' : 'Purchased' }}
          </button>
          <button
            type="button"
            class="nested-tab-button"
            [ngClass]="{ 'active': knowledgeSubTab === 'sales' }"
            (click)="setKnowledgeSubTab('sales')">
            {{ lang === 'ar' ? 'طلبات المبيعات' : 'Sold' }}
          </button>
        </div>
      </div>
    </div>


    <ng-container *ngIf="knowledgeSubTab === 'purchased'">
      <div class="nested-tab-content">
        <div class="row g-4">
    <!-- Loading State -->
    <div *ngIf="isLoading$ | async" class="col-12">
      <div class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
        <div class="spinner-border text-info" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">{{ lang === 'ar' ? 'جاري التحميل...' : 'Loading...' }}</span>
        </div>
      </div>
    </div>

    <!-- Orders Cards -->
    <div *ngFor="let order of orders$ | async" class="col-12">
      <div class="card card-custom gutter-b">
        <div class="card-body p-6">
          <!-- Order Header -->
          <div class="d-flex justify-content-between align-items-start mb-4">
            <div class="d-flex align-items-center">
              <div class="symbol symbol-40px me-3">
                <div class="symbol-label bg-light-info">
                  <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5.51253 7.31246L9.81753 8.40746H9.87753C9.93463 8.40912 9.99059 8.39118 10.0361 8.35661C10.0816 8.32204 10.1138 8.27293 10.1275 8.21746C10.1358 8.18545 10.1375 8.15212 10.1328 8.1194C10.1281 8.08669 10.1169 8.05524 10.0999 8.02688C10.0829 7.99851 10.0605 7.9738 10.0339 7.95416C10.0073 7.93452 9.97713 7.92035 9.94503 7.91246L5.63503 6.82496C5.60302 6.81692 5.56974 6.81526 5.53708 6.82008C5.50443 6.82489 5.47305 6.8361 5.44473 6.85304C5.41641 6.86999 5.3917 6.89235 5.37202 6.91884C5.35234 6.94534 5.33807 6.97545 5.33003 7.00746C5.32198 7.03947 5.32032 7.07275 5.32514 7.1054C5.32996 7.13805 5.34116 7.16944 5.35811 7.19776C5.37506 7.22608 5.39741 7.25079 5.42391 7.27047C5.4504 7.29015 5.48052 7.30442 5.51253 7.31246Z" fill="#3799FF"/>
                    <path d="M9.94 9.12996L5.635 8.03496C5.60316 8.02692 5.57004 8.02522 5.53754 8.02998C5.50504 8.03473 5.4738 8.04585 5.44559 8.06268C5.41739 8.07951 5.39277 8.10173 5.37315 8.12807C5.35354 8.15441 5.3393 8.18436 5.33125 8.21621C5.32321 8.24806 5.32152 8.28117 5.32627 8.31367C5.33103 8.34617 5.34214 8.37742 5.35897 8.40562C5.3758 8.43383 5.39802 8.45844 5.42437 8.47806C5.45071 8.49768 5.48066 8.51192 5.5125 8.51996L9.8175 9.61496H9.8775C9.94381 9.62325 10.0107 9.60486 10.0634 9.56383C10.1162 9.52281 10.1505 9.46251 10.1588 9.39621C10.167 9.32991 10.1487 9.26302 10.1076 9.21028C10.0666 9.15754 10.0063 9.12325 9.94 9.11496V9.12996Z" fill="#3799FF"/>
                    <path d="M3.16751 14.9999H3.48501L4.34751 20.2499L3.54501 21.0499C3.32339 21.2739 3.18937 21.5699 3.16726 21.8842C3.14515 22.1985 3.23641 22.5103 3.42449 22.7631C3.61257 23.0159 3.88501 23.1929 4.19241 23.262C4.49981 23.3312 4.82181 23.2879 5.10001 23.1399C5.26829 23.3316 5.47554 23.4852 5.70791 23.5904C5.94029 23.6956 6.19244 23.75 6.44751 23.7499H18.5525C18.9782 23.7519 19.3906 23.6019 19.7155 23.3269C20.0404 23.052 20.2566 22.6701 20.325 22.2499L21.515 14.9999H21.8325C22.0838 14.9999 22.3248 14.9001 22.5025 14.7224C22.6802 14.5447 22.78 14.3037 22.78 14.0524V12.7499C22.78 12.4986 22.6802 12.2576 22.5025 12.08C22.3248 11.9023 22.0838 11.8024 21.8325 11.8024H21.25V4.73494C21.2501 4.54827 21.2075 4.36406 21.1255 4.19637C21.0435 4.02867 20.9242 3.88194 20.7769 3.76737C20.6295 3.6528 20.4579 3.57343 20.2752 3.53531C20.0924 3.49719 19.9034 3.50134 19.7225 3.54744L19.5 3.59994V2.82994C19.5007 2.6892 19.4649 2.55068 19.3962 2.42786C19.3275 2.30505 19.2281 2.20213 19.1078 2.12913C18.9874 2.05613 18.8503 2.01553 18.7096 2.01129C18.5689 2.00705 18.4295 2.03931 18.305 2.10494L17.555 2.50244V1.96744C17.5547 1.82744 17.5134 1.69061 17.4362 1.57379C17.3591 1.45697 17.2494 1.36528 17.1208 1.31C16.9922 1.25473 16.8502 1.23829 16.7124 1.26271C16.5745 1.28713 16.4468 1.35134 16.345 1.44744L12.5 5.06744L8.66751 1.44744C8.56571 1.35134 8.43802 1.28713 8.30017 1.26271C8.16232 1.23829 8.02034 1.25473 7.89172 1.31C7.7631 1.36528 7.65346 1.45697 7.5763 1.57379C7.49915 1.69061 7.45786 1.82744 7.45751 1.96744V2.49994L6.85251 2.18494C6.71192 2.11166 6.55485 2.07575 6.39639 2.08066C6.23792 2.08556 6.08338 2.13111 5.94758 2.21294C5.81179 2.29477 5.69931 2.41012 5.62093 2.54794C5.54256 2.68575 5.50092 2.8414 5.50001 2.99994V3.59994L5.28501 3.54744C5.10363 3.49999 4.91378 3.49481 4.73008 3.5323C4.54638 3.56978 4.37374 3.64893 4.22545 3.76365C4.07716 3.87837 3.95718 4.0256 3.87475 4.19399C3.79233 4.36239 3.74965 4.54745 3.75001 4.73494V11.7974H3.16751C3.04267 11.7974 2.91905 11.8221 2.80376 11.87C2.68848 11.918 2.58381 11.9882 2.49576 12.0767C2.40771 12.1652 2.33802 12.2703 2.2907 12.3858C2.24338 12.5013 2.21936 12.6251 2.22001 12.7499V14.0574C2.22134 14.3079 2.32174 14.5476 2.49929 14.7242C2.67684 14.9008 2.91709 14.9999 3.16751 14.9999ZM4.00001 14.9999H9.59501L7.96251 16.6349C7.91261 16.3975 7.7707 16.1895 7.56783 16.0565C7.36497 15.9234 7.11766 15.8761 6.88001 15.9249H6.84001C6.60371 15.9743 6.3964 16.1149 6.26302 16.3161C6.12965 16.5174 6.08096 16.7631 6.12751 16.9999L6.37751 18.2074L4.78001 19.8049L4.00001 14.9999ZM6.80251 17.7924L6.61751 16.9074C6.60576 16.8534 6.60479 16.7976 6.61464 16.7432C6.6245 16.6888 6.645 16.6369 6.67496 16.5905C6.70492 16.544 6.74376 16.504 6.78924 16.4725C6.83473 16.4411 6.88596 16.419 6.94001 16.4074H6.97751C7.03157 16.395 7.08757 16.3935 7.1422 16.4031C7.19684 16.4126 7.24901 16.433 7.29562 16.4631C7.34223 16.4932 7.38235 16.5323 7.41359 16.5781C7.44483 16.6239 7.46657 16.6756 7.47751 16.7299L7.54501 17.0574L6.80251 17.7924ZM3.90001 22.5599C3.82397 22.4842 3.76363 22.3942 3.72246 22.2951C3.68129 22.196 3.6601 22.0898 3.6601 21.9824C3.6601 21.8751 3.68129 21.7689 3.72246 21.6698C3.76363 21.5707 3.82397 21.4807 3.90001 21.4049L6.83001 18.4724L8.00001 17.3149L10.3875 14.9299L11.655 13.6599C11.7296 13.5785 11.8198 13.5131 11.9203 13.4675C12.0209 13.4219 12.1296 13.3971 12.24 13.3947C12.3503 13.3923 12.46 13.4122 12.5625 13.4533C12.6649 13.4945 12.758 13.5559 12.836 13.6339C12.9141 13.712 12.9755 13.805 13.0166 13.9075C13.0577 14.0099 13.0777 14.1196 13.0752 14.23C13.0728 14.3403 13.0481 14.4491 13.0025 14.5496C12.9569 14.6501 12.8914 14.7404 12.81 14.8149L8.16001 19.4649L7.00001 20.6174L5.06001 22.5599C4.98403 22.6364 4.89367 22.6971 4.79413 22.7386C4.69459 22.78 4.58783 22.8013 4.48001 22.8013C4.3722 22.8013 4.26544 22.78 4.1659 22.7386C4.06636 22.6971 3.976 22.6364 3.90001 22.5599ZM11.4425 21.1924C11.453 21.3018 11.4196 21.4109 11.3498 21.4957C11.28 21.5805 11.1794 21.6342 11.07 21.6449H11.03C10.976 21.6502 10.9215 21.6447 10.8695 21.6288C10.8176 21.613 10.7694 21.587 10.7275 21.5524C10.6428 21.4812 10.5891 21.38 10.5775 21.2699L10.275 18.0449L11.0725 17.2499L11.4425 21.1924ZM8.39001 21.1424C8.41178 21.2504 8.39023 21.3627 8.33001 21.4549C8.29994 21.5007 8.261 21.54 8.21548 21.5705C8.16997 21.601 8.1188 21.6221 8.06501 21.6324H8.03001C7.97612 21.6453 7.92019 21.6471 7.86556 21.6379C7.81094 21.6286 7.75873 21.6085 7.71207 21.5786C7.6654 21.5487 7.62523 21.5098 7.59396 21.464C7.56268 21.4183 7.54093 21.3668 7.53001 21.3124L7.43501 20.8674L8.17001 20.1324L8.39001 21.1424ZM19.83 22.1624C19.7817 22.4663 19.6264 22.7428 19.3922 22.9422C19.1579 23.1416 18.8601 23.2508 18.5525 23.2499H6.44751C6.26891 23.2491 6.09245 23.2111 5.92933 23.1383C5.76621 23.0656 5.62 22.9597 5.50001 22.8274L7.03001 21.2974L7.05501 21.4224C7.09857 21.6282 7.21149 21.8128 7.37488 21.9452C7.53827 22.0776 7.74219 22.1499 7.95251 22.1499C8.01641 22.1506 8.08016 22.1439 8.14251 22.1299H8.17751C8.29524 22.1055 8.40699 22.0582 8.5064 21.9905C8.6058 21.9229 8.69091 21.8364 8.75685 21.7358C8.82278 21.6353 8.86826 21.5228 8.89068 21.4046C8.9131 21.2865 8.91203 21.1651 8.88751 21.0474L8.61251 19.7249L9.81501 18.4999L10.08 21.3149C10.1001 21.5444 10.206 21.7577 10.3766 21.9125C10.5471 22.0673 10.7697 22.1521 11 22.1499H11.0875H11.1275C11.3694 22.1265 11.5922 22.0081 11.7469 21.8206C11.9015 21.6331 11.9755 21.3919 11.9525 21.1499L11.5325 16.7874L13.1575 15.1649C13.2067 15.1129 13.2527 15.0578 13.295 14.9999H21L19.83 22.1624ZM19.83 4.03244C19.9368 4.00518 20.0484 4.00273 20.1563 4.02526C20.2642 4.0478 20.3655 4.09472 20.4525 4.16244C20.5435 4.22787 20.6178 4.31378 20.6695 4.41322C20.7212 4.51267 20.7488 4.62287 20.75 4.73494V11.7974H13.5925V5.61994L14.25 5.45244V8.03494C14.2504 8.182 14.2923 8.32597 14.3709 8.45023C14.4496 8.5745 14.5618 8.67399 14.6946 8.73724C14.8273 8.80049 14.9753 8.82491 15.1213 8.8077C15.2674 8.79048 15.4056 8.73232 15.52 8.63994L15.8675 8.35994L16.215 8.63994C16.3288 8.73805 16.4686 8.80108 16.6175 8.82141C16.7664 8.84174 16.9179 8.81849 17.0539 8.75449C17.1898 8.69049 17.3043 8.58847 17.3835 8.46077C17.4626 8.33307 17.5031 8.18516 17.5 8.03494V4.62994L19.3075 4.16994L19.83 4.03244ZM11.9075 11.7974V5.67744H13.0925V11.7974H11.9075ZM14.75 5.32494L17 4.74994V8.03494C16.9999 8.08736 16.985 8.13869 16.957 8.18298C16.929 8.22728 16.889 8.26272 16.8416 8.28522C16.7943 8.30772 16.7415 8.31634 16.6895 8.3101C16.6374 8.30385 16.5882 8.28299 16.5475 8.24994L16.0475 7.84244C16.003 7.8063 15.9474 7.78659 15.89 7.78659C15.8327 7.78659 15.7771 7.8063 15.7325 7.84244L15.2325 8.24994C15.1921 8.28328 15.143 8.30439 15.091 8.31077C15.039 8.31715 14.9862 8.30854 14.9389 8.28595C14.8917 8.26336 14.8518 8.22773 14.8241 8.18326C14.7964 8.13879 14.782 8.08733 14.7825 8.03494L14.75 5.32494ZM18.525 2.54994C18.5736 2.52216 18.6287 2.50773 18.6847 2.50811C18.7407 2.50848 18.7955 2.52366 18.8438 2.55208C18.892 2.58051 18.9319 2.62119 18.9593 2.66998C18.9867 2.71878 19.0008 2.77396 19 2.82994V3.72994L13.6775 5.08244L18.525 2.54994ZM16.6775 1.81244C16.708 1.78371 16.7462 1.76451 16.7874 1.75718C16.8286 1.74985 16.8711 1.75471 16.9095 1.77117C16.948 1.78763 16.9809 1.81497 17.0041 1.84983C17.0272 1.8847 17.0397 1.92557 17.04 1.96744V2.76244L13.9825 4.35744L16.6775 1.81244ZM7.96001 1.96744C7.96029 1.92557 7.97278 1.8847 7.99596 1.84983C8.01914 1.81497 8.05199 1.78763 8.09048 1.77117C8.12898 1.75471 8.17144 1.74985 8.21266 1.75718C8.25387 1.76451 8.29206 1.78371 8.32251 1.81244L11.0175 4.35744L7.96001 2.76244V1.96744ZM6.00001 2.99994C5.99926 2.92706 6.01748 2.85523 6.0529 2.79153C6.08831 2.72783 6.13969 2.67443 6.20198 2.6366C6.26428 2.59877 6.33535 2.5778 6.4082 2.57576C6.48106 2.57371 6.55319 2.59066 6.61751 2.62494L11.32 5.07744L6.00001 3.72744V2.99994ZM4.25001 4.72994C4.24924 4.61936 4.27412 4.5101 4.3227 4.41076C4.37129 4.31143 4.44225 4.22471 4.53001 4.15744C4.61698 4.08972 4.7183 4.0428 4.82619 4.02026C4.93409 3.99773 5.04571 4.00019 5.15251 4.02744L5.69001 4.16494L11.395 5.61494V11.7974H4.25001V4.72994ZM2.72251 12.7499C2.72251 12.6317 2.76932 12.5182 2.8527 12.4344C2.93608 12.3505 3.04926 12.3031 3.16751 12.3024H21.8325C21.9508 12.3031 22.0639 12.3505 22.1473 12.4344C22.2307 12.5182 22.2775 12.6317 22.2775 12.7499V14.0574C22.2769 14.175 22.2297 14.2876 22.1463 14.3705C22.0629 14.4534 21.9501 14.4999 21.8325 14.4999H13.515C13.5543 14.3085 13.5506 14.1107 13.504 13.9209C13.4574 13.7311 13.3691 13.554 13.2456 13.4025C13.1221 13.251 12.9665 13.1289 12.79 13.045C12.6134 12.9611 12.4205 12.9175 12.225 12.9174C12.052 12.9168 11.8806 12.9507 11.7209 13.0172C11.5612 13.0838 11.4164 13.1816 11.295 13.3049L10.0975 14.4999H3.16751C3.04949 14.4999 2.93631 14.4531 2.85285 14.3696C2.7694 14.2861 2.72251 14.173 2.72251 14.0549V12.7499Z" fill="#3799FF"/>
                    <path d="M13.0575 21.1449C13.0345 21.3868 13.1085 21.628 13.2632 21.8155C13.4178 22.003 13.6406 22.1215 13.8825 22.1449H13.9225H14C14.2278 22.1446 14.4473 22.0594 14.6156 21.9059C14.7839 21.7524 14.8889 21.5417 14.91 21.3149L15.3325 16.8149C15.3555 16.5729 15.2815 16.3317 15.1269 16.1442C14.9722 15.9567 14.7494 15.8383 14.5075 15.8149H14.4675C14.3475 15.8035 14.2265 15.8159 14.1112 15.8513C13.996 15.8868 13.8889 15.9446 13.7961 16.0214C13.7032 16.0983 13.6264 16.1927 13.57 16.2992C13.5136 16.4058 13.4788 16.5224 13.4675 16.6424L13.0575 21.1449ZM13.5575 21.1924L13.98 16.6924C13.9894 16.5894 14.0368 16.4936 14.1131 16.4237C14.1895 16.3539 14.2891 16.3151 14.3925 16.3149H14.43H14.47C14.5242 16.3196 14.5769 16.335 14.625 16.3602C14.6732 16.3855 14.7158 16.42 14.7505 16.4619C14.7851 16.5038 14.8111 16.5521 14.8269 16.6041C14.8427 16.6562 14.848 16.7108 14.8425 16.7649L14.4225 21.2649C14.411 21.3749 14.3572 21.4762 14.2725 21.5474C14.2307 21.5819 14.1824 21.6079 14.1305 21.6238C14.0786 21.6397 14.024 21.6451 13.97 21.6399H13.93C13.8216 21.6291 13.7218 21.5761 13.6521 21.4924C13.5824 21.4087 13.5485 21.3009 13.5575 21.1924Z" fill="#3799FF"/>
                    <path d="M16.8275 22.1225H16.8675C16.9293 22.1342 16.9921 22.14 17.055 22.14C17.2653 22.1399 17.4693 22.0676 17.6326 21.9352C17.796 21.8028 17.909 21.6182 17.9525 21.4125L18.39 19.31L18.8725 17C18.9213 16.7623 18.874 16.515 18.741 16.3121C18.6079 16.1093 18.3999 15.9674 18.1625 15.9175H18.1225C17.8849 15.8686 17.6376 15.9159 17.4347 16.049C17.2318 16.182 17.0899 16.39 17.04 16.6275L16.12 21.04C16.0704 21.2773 16.1171 21.5246 16.2498 21.7276C16.3824 21.9306 16.5902 22.0726 16.8275 22.1225ZM16.61 21.1425L17.53 16.73C17.5496 16.6364 17.6008 16.5526 17.675 16.4924C17.7493 16.4323 17.842 16.3997 17.9375 16.4H18.0225H18.06C18.1141 16.4115 18.1653 16.4336 18.2108 16.4651C18.2563 16.4965 18.2951 16.5365 18.3251 16.583C18.355 16.6295 18.3755 16.6814 18.3854 16.7358C18.3952 16.7901 18.3943 16.8459 18.3825 16.9L17.9 19.2175L17.46 21.32C17.4491 21.3743 17.4273 21.4258 17.3961 21.4716C17.3648 21.5173 17.3246 21.5563 17.2779 21.5861C17.2313 21.616 17.1791 21.6361 17.1245 21.6454C17.0698 21.6546 17.0139 21.6528 16.96 21.64H16.92C16.817 21.6151 16.7274 21.5515 16.67 21.4625C16.6392 21.4158 16.618 21.3635 16.6077 21.3085C16.5974 21.2536 16.5982 21.1971 16.61 21.1425Z" fill="#3799FF"/>
                    </svg>
                    
                    
                      

                </div>
              </div>
              <div>
                <div class="d-flex align-items-center mb-1">
                  <h6 class="mb-0 fw-bold me-2">
                    {{ lang === 'ar' ? 'طلب رقم' : 'Order' }} {{ order.order_no }}
                  </h6>
                  <button 
                    type="button" 
                    class="btn btn-sm btn-light-info p-1"
                    (click)="copyOrderNo(order.order_no)"
                    [title]="lang === 'ar' ? 'نسخ رقم الطلب' : 'Copy Order Number'">
                    <i class="ki-outline ki-copy fs-6"></i>
                  </button>
                </div>
                <div class="text-muted fs-7">{{ order.amount === 0 ? (lang === 'ar' ? 'مجاني' : 'Free') : '$' + order.amount }}</div>
              </div>
            </div>
            <div class="d-flex gap-2">
              <button 
                type="button" 
                class="btn btn-info btn-sm"
                (click)="openOrderDetails(order)">
                {{ lang === 'ar' ? 'تفاصيل الطلب' : 'Order Details' }}
              </button>
              <button 
                type="button" 
                class="btn btn-light-info btn-sm"
                (click)="downloadInvoice(order)">
                <i class="ki-outline ki-file-down fs-6 me-1"></i>
                {{ lang === 'ar' ? 'تحميل الفاتورة' : 'Download Invoice' }}
              </button>
            </div>
          </div>

          <!-- Knowledge Items -->
          <div *ngIf="order.orderable" class="mb-3">
            <div *ngFor="let knowledge of order.orderable.knowledge" class="mb-2">
              <div class="d-flex align-items-center ">
                <div >
                  <a 
                  [pTooltip]="lang ==='ar' ? 'عرض في التحميلات' : 'View in downloads'"
                  (click)="navigateToDownloads(order)"
                    target="_blank"
                    class="text-info text-decoration-none fw-bold fs-6 cursor-pointer">
                    {{ knowledge.title }}
                  </a>
                </div>
                <!-- <button 
                  type="button" 
                  class="btn btn-xs btn-light-info ms-2"
                  (click)="navigateToDownloads(knowledge.title)"
                  [title]="lang === 'ar' ? 'عرض في المعرفة' : 'View in Knowledge'">
                  <i class="ki-outline ki-eye fs-6"></i>
                  {{ lang === 'ar' ? 'عرض في المعرفة' : 'View in Knowledge' }}
                </button> -->
              </div>
              
              <!-- Documents Preview -->
              <div *ngIf="order.orderable.knowledge_documents && order.orderable.knowledge_documents.length > 0" class="mt-2">
                <div class="d-flex flex-wrap pt-2 gap-2">
                  <div *ngFor="let extension of getUniqueExtensions(order.orderable)" class="position-relative d-inline-block">
                    <img 
                      [src]="getFileIconByExtension(extension)" 
                      [alt]="extension"
                      class="file-icon"
                      style="width: 40px; height: 40px;"
                      onerror="this.style.display='none'">
                    <span 
                      class="position-absolute top-0 start-75 translate-middle badge rounded-pill text-white"
                      [style.background-color]="getBadgeColorByExtension(extension)">
                      {{ getDocumentCountByExtension(order.orderable, extension) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Info -->
          <div class="border-top pt-3 mt-3">
            <div class="text-muted fs-7">
              {{ lang === 'ar' ? 'تاريخ الطلب' : 'Ordered' }} {{ order.date | date:'short' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="(orders$ | async)?.length === 0 && !(isLoading$ | async)" class="col-12">
      <div class="card">
        <div class="text-center py-10">
          <div class="symbol symbol-100px mx-auto mb-4">
            <div class="symbol-label bg-light-info">
              <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5.51253 7.31246L9.81753 8.40746H9.87753C9.93463 8.40912 9.99059 8.39118 10.0361 8.35661C10.0816 8.32204 10.1138 8.27293 10.1275 8.21746C10.1358 8.18545 10.1375 8.15212 10.1328 8.1194C10.1281 8.08669 10.1169 8.05524 10.0999 8.02688C10.0829 7.99851 10.0605 7.9738 10.0339 7.95416C10.0073 7.93452 9.97713 7.92035 9.94503 7.91246L5.63503 6.82496C5.60302 6.81692 5.56974 6.81526 5.53708 6.82008C5.50443 6.82489 5.47305 6.8361 5.44473 6.85304C5.41641 6.86999 5.3917 6.89235 5.37202 6.91884C5.35234 6.94534 5.33807 6.97545 5.33003 7.00746C5.32198 7.03947 5.32032 7.07275 5.32514 7.1054C5.32996 7.13805 5.34116 7.16944 5.35811 7.19776C5.37506 7.22608 5.39741 7.25079 5.42391 7.27047C5.4504 7.29015 5.48052 7.30442 5.51253 7.31246Z" fill="#3799FF"/>
                <path d="M9.94 9.12996L5.635 8.03496C5.60316 8.02692 5.57004 8.02522 5.53754 8.02998C5.50504 8.03473 5.4738 8.04585 5.44559 8.06268C5.41739 8.07951 5.39277 8.10173 5.37315 8.12807C5.35354 8.15441 5.3393 8.18436 5.33125 8.21621C5.32321 8.24806 5.32152 8.28117 5.32627 8.31367C5.33103 8.34617 5.34214 8.37742 5.35897 8.40562C5.3758 8.43383 5.39802 8.45844 5.42437 8.47806C5.45071 8.49768 5.48066 8.51192 5.5125 8.51996L9.8175 9.61496H9.8775C9.94381 9.62325 10.0107 9.60486 10.0634 9.56383C10.1162 9.52281 10.1505 9.46251 10.1588 9.39621C10.167 9.32991 10.1487 9.26302 10.1076 9.21028C10.0666 9.15754 10.0063 9.12325 9.94 9.11496V9.12996Z" fill="#3799FF"/>
                <path d="M3.16751 14.9999H3.48501L4.34751 20.2499L3.54501 21.0499C3.32339 21.2739 3.18937 21.5699 3.16726 21.8842C3.14515 22.1985 3.23641 22.5103 3.42449 22.7631C3.61257 23.0159 3.88501 23.1929 4.19241 23.262C4.49981 23.3312 4.82181 23.2879 5.10001 23.1399C5.26829 23.3316 5.47554 23.4852 5.70791 23.5904C5.94029 23.6956 6.19244 23.75 6.44751 23.7499H18.5525C18.9782 23.7519 19.3906 23.6019 19.7155 23.3269C20.0404 23.052 20.2566 22.6701 20.325 22.2499L21.515 14.9999H21.8325C22.0838 14.9999 22.3248 14.9001 22.5025 14.7224C22.6802 14.5447 22.78 14.3037 22.78 14.0524V12.7499C22.78 12.4986 22.6802 12.2576 22.5025 12.08C22.3248 11.9023 22.0838 11.8024 21.8325 11.8024H21.25V4.73494C21.2501 4.54827 21.2075 4.36406 21.1255 4.19637C21.0435 4.02867 20.9242 3.88194 20.7769 3.76737C20.6295 3.6528 20.4579 3.57343 20.2752 3.53531C20.0924 3.49719 19.9034 3.50134 19.7225 3.54744L19.5 3.59994V2.82994C19.5007 2.6892 19.4649 2.55068 19.3962 2.42786C19.3275 2.30505 19.2281 2.20213 19.1078 2.12913C18.9874 2.05613 18.8503 2.01553 18.7096 2.01129C18.5689 2.00705 18.4295 2.03931 18.305 2.10494L17.555 2.50244V1.96744C17.5547 1.82744 17.5134 1.69061 17.4362 1.57379C17.3591 1.45697 17.2494 1.36528 17.1208 1.31C16.9922 1.25473 16.8502 1.23829 16.7124 1.26271C16.5745 1.28713 16.4468 1.35134 16.345 1.44744L12.5 5.06744L8.66751 1.44744C8.56571 1.35134 8.43802 1.28713 8.30017 1.26271C8.16232 1.23829 8.02034 1.25473 7.89172 1.31C7.7631 1.36528 7.65346 1.45697 7.5763 1.57379C7.49915 1.69061 7.45786 1.82744 7.45751 1.96744V2.49994L6.85251 2.18494C6.71192 2.11166 6.55485 2.07575 6.39639 2.08066C6.23792 2.08556 6.08338 2.13111 5.94758 2.21294C5.81179 2.29477 5.69931 2.41012 5.62093 2.54794C5.54256 2.68575 5.50092 2.8414 5.50001 2.99994V3.59994L5.28501 3.54744C5.10363 3.49999 4.91378 3.49481 4.73008 3.5323C4.54638 3.56978 4.37374 3.64893 4.22545 3.76365C4.07716 3.87837 3.95718 4.0256 3.87475 4.19399C3.79233 4.36239 3.74965 4.54745 3.75001 4.73494V11.7974H3.16751C3.04267 11.7974 2.91905 11.8221 2.80376 11.87C2.68848 11.918 2.58381 11.9882 2.49576 12.0767C2.40771 12.1652 2.33802 12.2703 2.2907 12.3858C2.24338 12.5013 2.21936 12.6251 2.22001 12.7499V14.0574C2.22134 14.3079 2.32174 14.5476 2.49929 14.7242C2.67684 14.9008 2.91709 14.9999 3.16751 14.9999ZM4.00001 14.9999H9.59501L7.96251 16.6349C7.91261 16.3975 7.7707 16.1895 7.56783 16.0565C7.36497 15.9234 7.11766 15.8761 6.88001 15.9249H6.84001C6.60371 15.9743 6.3964 16.1149 6.26302 16.3161C6.12965 16.5174 6.08096 16.7631 6.12751 16.9999L6.37751 18.2074L4.78001 19.8049L4.00001 14.9999ZM6.80251 17.7924L6.61751 16.9074C6.60576 16.8534 6.60479 16.7976 6.61464 16.7432C6.6245 16.6888 6.645 16.6369 6.67496 16.5905C6.70492 16.544 6.74376 16.504 6.78924 16.4725C6.83473 16.4411 6.88596 16.419 6.94001 16.4074H6.97751C7.03157 16.395 7.08757 16.3935 7.1422 16.4031C7.19684 16.4126 7.24901 16.433 7.29562 16.4631C7.34223 16.4932 7.38235 16.5323 7.41359 16.5781C7.44483 16.6239 7.46657 16.6756 7.47751 16.7299L7.54501 17.0574L6.80251 17.7924ZM3.90001 22.5599C3.82397 22.4842 3.76363 22.3942 3.72246 22.2951C3.68129 22.196 3.6601 22.0898 3.6601 21.9824C3.6601 21.8751 3.68129 21.7689 3.72246 21.6698C3.76363 21.5707 3.82397 21.4807 3.90001 21.4049L6.83001 18.4724L8.00001 17.3149L10.3875 14.9299L11.655 13.6599C11.7296 13.5785 11.8198 13.5131 11.9203 13.4675C12.0209 13.4219 12.1296 13.3971 12.24 13.3947C12.3503 13.3923 12.46 13.4122 12.5625 13.4533C12.6649 13.4945 12.758 13.5559 12.836 13.6339C12.9141 13.712 12.9755 13.805 13.0166 13.9075C13.0577 14.0099 13.0777 14.1196 13.0752 14.23C13.0728 14.3403 13.0481 14.4491 13.0025 14.5496C12.9569 14.6501 12.8914 14.7404 12.81 14.8149L8.16001 19.4649L7.00001 20.6174L5.06001 22.5599C4.98403 22.6364 4.89367 22.6971 4.79413 22.7386C4.69459 22.78 4.58783 22.8013 4.48001 22.8013C4.3722 22.8013 4.26544 22.78 4.1659 22.7386C4.06636 22.6971 3.976 22.6364 3.90001 22.5599ZM11.4425 21.1924C11.453 21.3018 11.4196 21.4109 11.3498 21.4957C11.28 21.5805 11.1794 21.6342 11.07 21.6449H11.03C10.976 21.6502 10.9215 21.6447 10.8695 21.6288C10.8176 21.613 10.7694 21.587 10.7275 21.5524C10.6428 21.4812 10.5891 21.38 10.5775 21.2699L10.275 18.0449L11.0725 17.2499L11.4425 21.1924ZM8.39001 21.1424C8.41178 21.2504 8.39023 21.3627 8.33001 21.4549C8.29994 21.5007 8.261 21.54 8.21548 21.5705C8.16997 21.601 8.1188 21.6221 8.06501 21.6324H8.03001C7.97612 21.6453 7.92019 21.6471 7.86556 21.6379C7.81094 21.6286 7.75873 21.6085 7.71207 21.5786C7.6654 21.5487 7.62523 21.5098 7.59396 21.464C7.56268 21.4183 7.54093 21.3668 7.53001 21.3124L7.43501 20.8674L8.17001 20.1324L8.39001 21.1424ZM19.83 22.1624C19.7817 22.4663 19.6264 22.7428 19.3922 22.9422C19.1579 23.1416 18.8601 23.2508 18.5525 23.2499H6.44751C6.26891 23.2491 6.09245 23.2111 5.92933 23.1383C5.76621 23.0656 5.62 22.9597 5.50001 22.8274L7.03001 21.2974L7.05501 21.4224C7.09857 21.6282 7.21149 21.8128 7.37488 21.9452C7.53827 22.0776 7.74219 22.1499 7.95251 22.1499C8.01641 22.1506 8.08016 22.1439 8.14251 22.1299H8.17751C8.29524 22.1055 8.40699 22.0582 8.5064 21.9905C8.6058 21.9229 8.69091 21.8364 8.75685 21.7358C8.82278 21.6353 8.86826 21.5228 8.89068 21.4046C8.9131 21.2865 8.91203 21.1651 8.88751 21.0474L8.61251 19.7249L9.81501 18.4999L10.08 21.3149C10.1001 21.5444 10.206 21.7577 10.3766 21.9125C10.5471 22.0673 10.7697 22.1521 11 22.1499H11.0875H11.1275C11.3694 22.1265 11.5922 22.0081 11.7469 21.8206C11.9015 21.6331 11.9755 21.3919 11.9525 21.1499L11.5325 16.7874L13.1575 15.1649C13.2067 15.1129 13.2527 15.0578 13.295 14.9999H21L19.83 22.1624ZM19.83 4.03244C19.9368 4.00518 20.0484 4.00273 20.1563 4.02526C20.2642 4.0478 20.3655 4.09472 20.4525 4.16244C20.5435 4.22787 20.6178 4.31378 20.6695 4.41322C20.7212 4.51267 20.7488 4.62287 20.75 4.73494V11.7974H13.5925V5.61994L14.25 5.45244V8.03494C14.2504 8.182 14.2923 8.32597 14.3709 8.45023C14.4496 8.5745 14.5618 8.67399 14.6946 8.73724C14.8273 8.80049 14.9753 8.82491 15.1213 8.8077C15.2674 8.79048 15.4056 8.73232 15.52 8.63994L15.8675 8.35994L16.215 8.63994C16.3288 8.73805 16.4686 8.80108 16.6175 8.82141C16.7664 8.84174 16.9179 8.81849 17.0539 8.75449C17.1898 8.69049 17.3043 8.58847 17.3835 8.46077C17.4626 8.33307 17.5031 8.18516 17.5 8.03494V4.62994L19.3075 4.16994L19.83 4.03244ZM11.9075 11.7974V5.67744H13.0925V11.7974H11.9075ZM14.75 5.32494L17 4.74994V8.03494C16.9999 8.08736 16.985 8.13869 16.957 8.18298C16.929 8.22728 16.889 8.26272 16.8416 8.28522C16.7943 8.30772 16.7415 8.31634 16.6895 8.3101C16.6374 8.30385 16.5882 8.28299 16.5475 8.24994L16.0475 7.84244C16.003 7.8063 15.9474 7.78659 15.89 7.78659C15.8327 7.78659 15.7771 7.8063 15.7325 7.84244L15.2325 8.24994C15.1921 8.28328 15.143 8.30439 15.091 8.31077C15.039 8.31715 14.9862 8.30854 14.9389 8.28595C14.8917 8.26336 14.8518 8.22773 14.8241 8.18326C14.7964 8.13879 14.782 8.08733 14.7825 8.03494L14.75 5.32494ZM18.525 2.54994C18.5736 2.52216 18.6287 2.50773 18.6847 2.50811C18.7407 2.50848 18.7955 2.52366 18.8438 2.55208C18.892 2.58051 18.9319 2.62119 18.9593 2.66998C18.9867 2.71878 19.0008 2.77396 19 2.82994V3.72994L13.6775 5.08244L18.525 2.54994ZM16.6775 1.81244C16.708 1.78371 16.7462 1.76451 16.7874 1.75718C16.8286 1.74985 16.8711 1.75471 16.9095 1.77117C16.948 1.78763 16.9809 1.81497 17.0041 1.84983C17.0272 1.8847 17.0397 1.92557 17.04 1.96744V2.76244L13.9825 4.35744L16.6775 1.81244ZM7.96001 1.96744C7.96029 1.92557 7.97278 1.8847 7.99596 1.84983C8.01914 1.81497 8.05199 1.78763 8.09048 1.77117C8.12898 1.75471 8.17144 1.74985 8.21266 1.75718C8.25387 1.76451 8.29206 1.78371 8.32251 1.81244L11.0175 4.35744L7.96001 2.76244V1.96744ZM6.00001 2.99994C5.99926 2.92706 6.01748 2.85523 6.0529 2.79153C6.08831 2.72783 6.13969 2.67443 6.20198 2.6366C6.26428 2.59877 6.33535 2.5778 6.4082 2.57576C6.48106 2.57371 6.55319 2.59066 6.61751 2.62494L11.32 5.07744L6.00001 3.72744V2.99994ZM4.25001 4.72994C4.24924 4.61936 4.27412 4.5101 4.3227 4.41076C4.37129 4.31143 4.44225 4.22471 4.53001 4.15744C4.61698 4.08972 4.7183 4.0428 4.82619 4.02026C4.93409 3.99773 5.04571 4.00019 5.15251 4.02744L5.69001 4.16494L11.395 5.61494V11.7974H4.25001V4.72994ZM2.72251 12.7499C2.72251 12.6317 2.76932 12.5182 2.8527 12.4344C2.93608 12.3505 3.04926 12.3031 3.16751 12.3024H21.8325C21.9508 12.3031 22.0639 12.3505 22.1473 12.4344C22.2307 12.5182 22.2775 12.6317 22.2775 12.7499V14.0574C22.2769 14.175 22.2297 14.2876 22.1463 14.3705C22.0629 14.4534 21.9501 14.4999 21.8325 14.4999H13.515C13.5543 14.3085 13.5506 14.1107 13.504 13.9209C13.4574 13.7311 13.3691 13.554 13.2456 13.4025C13.1221 13.251 12.9665 13.1289 12.79 13.045C12.6134 12.9611 12.4205 12.9175 12.225 12.9174C12.052 12.9168 11.8806 12.9507 11.7209 13.0172C11.5612 13.0838 11.4164 13.1816 11.295 13.3049L10.0975 14.4999H3.16751C3.04949 14.4999 2.93631 14.4531 2.85285 14.3696C2.7694 14.2861 2.72251 14.173 2.72251 14.0549V12.7499Z" fill="#3799FF"/>
                <path d="M13.0575 21.1449C13.0345 21.3868 13.1085 21.628 13.2632 21.8155C13.4178 22.003 13.6406 22.1215 13.8825 22.1449H13.9225H14C14.2278 22.1446 14.4473 22.0594 14.6156 21.9059C14.7839 21.7524 14.8889 21.5417 14.91 21.3149L15.3325 16.8149C15.3555 16.5729 15.2815 16.3317 15.1269 16.1442C14.9722 15.9567 14.7494 15.8383 14.5075 15.8149H14.4675C14.3475 15.8035 14.2265 15.8159 14.1112 15.8513C13.996 15.8868 13.8889 15.9446 13.7961 16.0214C13.7032 16.0983 13.6264 16.1927 13.57 16.2992C13.5136 16.4058 13.4788 16.5224 13.4675 16.6424L13.0575 21.1449ZM13.5575 21.1924L13.98 16.6924C13.9894 16.5894 14.0368 16.4936 14.1131 16.4237C14.1895 16.3539 14.2891 16.3151 14.3925 16.3149H14.43H14.47C14.5242 16.3196 14.5769 16.335 14.625 16.3602C14.6732 16.3855 14.7158 16.42 14.7505 16.4619C14.7851 16.5038 14.8111 16.5521 14.8269 16.6041C14.8427 16.6562 14.848 16.7108 14.8425 16.7649L14.4225 21.2649C14.411 21.3749 14.3572 21.4762 14.2725 21.5474C14.2307 21.5819 14.1824 21.6079 14.1305 21.6238C14.0786 21.6397 14.024 21.6451 13.97 21.6399H13.93C13.8216 21.6291 13.7218 21.5761 13.6521 21.4924C13.5824 21.4087 13.5485 21.3009 13.5575 21.1924Z" fill="#3799FF"/>
                <path d="M16.8275 22.1225H16.8675C16.9293 22.1342 16.9921 22.14 17.055 22.14C17.2653 22.1399 17.4693 22.0676 17.6326 21.9352C17.796 21.8028 17.909 21.6182 17.9525 21.4125L18.39 19.31L18.8725 17C18.9213 16.7623 18.874 16.515 18.741 16.3121C18.6079 16.1093 18.3999 15.9674 18.1625 15.9175H18.1225C17.8849 15.8686 17.6376 15.9159 17.4347 16.049C17.2318 16.182 17.0899 16.39 17.04 16.6275L16.12 21.04C16.0704 21.2773 16.1171 21.5246 16.2498 21.7276C16.3824 21.9306 16.5902 22.0726 16.8275 22.1225ZM16.61 21.1425L17.53 16.73C17.5496 16.6364 17.6008 16.5526 17.675 16.4924C17.7493 16.4323 17.842 16.3997 17.9375 16.4H18.0225H18.06C18.1141 16.4115 18.1653 16.4336 18.2108 16.4651C18.2563 16.4965 18.2951 16.5365 18.3251 16.583C18.355 16.6295 18.3755 16.6814 18.3854 16.7358C18.3952 16.7901 18.3943 16.8459 18.3825 16.9L17.9 19.2175L17.46 21.32C17.4491 21.3743 17.4273 21.4258 17.3961 21.4716C17.3648 21.5173 17.3246 21.5563 17.2779 21.5861C17.2313 21.616 17.1791 21.6361 17.1245 21.6454C17.0698 21.6546 17.0139 21.6528 16.96 21.64H16.92C16.817 21.6151 16.7274 21.5515 16.67 21.4625C16.6392 21.4158 16.618 21.3635 16.6077 21.3085C16.5974 21.2536 16.5982 21.1971 16.61 21.1425Z" fill="#3799FF"/>
                </svg>
                
                
            </div>
          </div>
          <h5 class="mb-3">{{ lang === 'ar' ? 'لا توجد طلبات' : 'No Orders Found' }}</h5>
          <p class="text-muted">
            {{ lang === 'ar' ? 'لم تقم بأي طلبات بعد' : 'You haven\'t placed any orders yet.' }}
          </p>
        </div>
      </div>
    </div>
  </div>

    <!-- Pagination for Knowledge Orders -->
    <div *ngIf="(totalPages$ | async)! > 1" class="d-flex justify-content-center mt-6">
      <p-paginator
        [rows]="10"
        [totalRecords]="(totalPages$ | async)! * 10"
        [first]="(currentPage - 1) * 10"
        (onPageChange)="onPageChange(($event.page || 0) + 1)"
        [showCurrentPageReport]="true"
        [currentPageReportTemplate]="lang === 'ar' ? 'عرض {first} إلى {last} من {totalRecords} طلب' : 'Showing {first} to {last} of {totalRecords} orders'">
      </p-paginator>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="knowledgeSubTab === 'sales'">
      <div class="nested-tab-content">
        <div class="row g-4">
        <div *ngIf="isSalesLoading$ | async" class="col-12">
          <div class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
            <div class="spinner-border text-info" role="status" style="width: 3rem; height: 3rem;">
              <span class="visually-hidden">{{ lang === 'ar' ? 'جاري التحميل...' : 'Loading...' }}</span>
            </div>
          </div>
        </div>

        <div *ngFor="let order of salesOrders$ | async" class="col-12">
          <div class="card card-custom gutter-b">
            <div class="card-body p-6">
              <!-- Order Header -->
              <div class="d-flex justify-content-between align-items-start mb-4">
                <div class="d-flex align-items-center">
                  <div class="symbol symbol-40px me-3">
                    <div class="symbol-label bg-light-info">
                      <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5.51253 7.31246L9.81753 8.40746H9.87753C9.93463 8.40912 9.99059 8.39118 10.0361 8.35661C10.0816 8.32204 10.1138 8.27293 10.1275 8.21746C10.1358 8.18545 10.1375 8.15212 10.1328 8.1194C10.1281 8.08669 10.1169 8.05524 10.0999 8.02688C10.0829 7.99851 10.0605 7.9738 10.0339 7.95416C10.0073 7.93452 9.97713 7.92035 9.94503 7.91246L5.63503 6.82496C5.60302 6.81692 5.56974 6.81526 5.53708 6.82008C5.50443 6.82489 5.47305 6.8361 5.44473 6.85304C5.41641 6.86999 5.3917 6.89235 5.37202 6.91884C5.35234 6.94534 5.33807 6.97545 5.33003 7.00746C5.32198 7.03947 5.32032 7.07275 5.32514 7.1054C5.32996 7.13805 5.34116 7.16944 5.35811 7.19776C5.37506 7.22608 5.39741 7.25079 5.42391 7.27047C5.4504 7.29015 5.48052 7.30442 5.51253 7.31246Z" fill="#3799FF"/>
                        <path d="M9.94 9.12996L5.635 8.03496C5.60316 8.02692 5.57004 8.02522 5.53754 8.02998C5.50504 8.03473 5.4738 8.04585 5.44559 8.06268C5.41739 8.07951 5.39277 8.10173 5.37315 8.12807C5.35354 8.15441 5.3393 8.18436 5.33125 8.21621C5.32321 8.24806 5.32152 8.28117 5.32627 8.31367C5.33103 8.34617 5.34214 8.37742 5.35897 8.40562C5.3758 8.43383 5.39802 8.45844 5.42437 8.47806C5.45071 8.49768 5.48066 8.51192 5.5125 8.51996L9.8175 9.61496H9.8775C9.94381 9.62325 10.0107 9.60486 10.0634 9.56383C10.1162 9.52281 10.1505 9.46251 10.1588 9.39621C10.167 9.32991 10.1487 9.26302 10.1076 9.21028C10.0666 9.15754 10.0063 9.12325 9.94 9.11496V9.12996Z" fill="#3799FF"/>
                        <path d="M3.16751 14.9999H3.48501L4.34751 20.2499L3.54501 21.0499C3.32339 21.2739 3.18937 21.5699 3.16726 21.8842C3.14515 22.1985 3.23641 22.5103 3.42449 22.7631C3.61257 23.0159 3.88501 23.1929 4.19241 23.262C4.49981 23.3312 4.82181 23.2879 5.10001 23.1399C5.26829 23.3316 5.47554 23.4852 5.70791 23.5904C5.94029 23.6956 6.19244 23.75 6.44751 23.7499H18.5525C18.9782 23.7519 19.3906 23.6019 19.7155 23.3269C20.0404 23.052 20.2566 22.6701 20.325 22.2499L21.515 14.9999H21.8325C22.0838 14.9999 22.3248 14.9001 22.5025 14.7224C22.6802 14.5447 22.78 14.3037 22.78 14.0524V12.7499C22.78 12.4986 22.6802 12.2576 22.5025 12.08C22.3248 11.9023 22.0838 11.8024 21.8325 11.8024H21.25V4.73494C21.2501 4.54827 21.2075 4.36406 21.1255 4.19637C21.0435 4.02867 20.9242 3.88194 20.7769 3.76737C20.6295 3.6528 20.4579 3.57343 20.2752 3.53531C20.0924 3.49719 19.9034 3.50134 19.7225 3.54744L19.5 3.59994V2.82994C19.5007 2.6892 19.4649 2.55068 19.3962 2.42786C19.3275 2.30505 19.2281 2.20213 19.1078 2.12913C18.9874 2.05613 18.8503 2.01553 18.7096 2.01129C18.5689 2.00705 18.4295 2.03931 18.305 2.10494L17.555 2.50244V1.96744C17.5547 1.82744 17.5134 1.69061 17.4362 1.57379C17.3591 1.45697 17.2494 1.36528 17.1208 1.31C16.9922 1.25473 16.8502 1.23829 16.7124 1.26271C16.5745 1.28713 16.4468 1.35134 16.345 1.44744L12.5 5.06744L8.66751 1.44744C8.56571 1.35134 8.43802 1.28713 8.30017 1.26271C8.16232 1.23829 8.02034 1.25473 7.89172 1.31C7.7631 1.36528 7.65346 1.45697 7.5763 1.57379C7.49915 1.69061 7.45786 1.82744 7.45751 1.96744V2.49994L6.85251 2.18494C6.71192 2.11166 6.55485 2.07575 6.39639 2.08066C6.23792 2.08556 6.08338 2.13111 5.94758 2.21294C5.81179 2.29477 5.69931 2.41012 5.62093 2.54794C5.54256 2.68575 5.50092 2.8414 5.50001 2.99994V3.59994L5.28501 3.54744C5.10363 3.49999 4.91378 3.49481 4.73008 3.5323C4.54638 3.56978 4.37374 3.64893 4.22545 3.76365C4.07716 3.87837 3.95718 4.0256 3.87475 4.19399C3.79233 4.36239 3.74965 4.54745 3.75001 4.73494V11.7974H3.16751C3.04267 11.7974 2.91905 11.8221 2.80376 11.87C2.68848 11.918 2.58381 11.9882 2.49576 12.0767C2.40771 12.1652 2.33802 12.2703 2.2907 12.3858C2.24338 12.5013 2.21936 12.6251 2.22001 12.7499V14.0574C2.22134 14.3079 2.32174 14.5476 2.49929 14.7242C2.67684 14.9008 2.91709 14.9999 3.16751 14.9999ZM4.00001 14.9999H9.59501L7.96251 16.6349C7.91261 16.3975 7.7707 16.1895 7.56783 16.0565C7.36497 15.9234 7.11766 15.8761 6.88001 15.9249H6.84001C6.60371 15.9743 6.3964 16.1149 6.26302 16.3161C6.12965 16.5174 6.08096 16.7631 6.12751 16.9999L6.37751 18.2074L4.78001 19.8049L4.00001 14.9999ZM6.80251 17.7924L6.61751 16.9074C6.60576 16.8534 6.60479 16.7976 6.61464 16.7432C6.6245 16.6888 6.645 16.6369 6.67496 16.5905C6.70492 16.544 6.74376 16.504 6.78924 16.4725C6.83473 16.4411 6.88596 16.419 6.94001 16.4074H6.97751C7.03157 16.395 7.08757 16.3935 7.1422 16.4031C7.19684 16.4126 7.24901 16.433 7.29562 16.4631C7.34223 16.4932 7.38235 16.5323 7.41359 16.5781C7.44483 16.6239 7.46657 16.6756 7.47751 16.7299L7.54501 17.0574L6.80251 17.7924ZM3.90001 22.5599C3.82397 22.4842 3.76363 22.3942 3.72246 22.2951C3.68129 22.196 3.6601 22.0898 3.6601 21.9824C3.6601 21.8751 3.68129 21.7689 3.72246 21.6698C3.76363 21.5707 3.82397 21.4807 3.90001 21.4049L6.83001 18.4724L8.00001 17.3149L10.3875 14.9299L11.655 13.6599C11.7296 13.5785 11.8198 13.5131 11.9203 13.4675C12.0209 13.4219 12.1296 13.3971 12.24 13.3947C12.3503 13.3923 12.46 13.4122 12.5625 13.4533C12.6649 13.4945 12.758 13.5559 12.836 13.6339C12.9141 13.712 12.9755 13.805 13.0166 13.9075C13.0577 14.0099 13.0777 14.1196 13.0752 14.23C13.0728 14.3403 13.0481 14.4491 13.0025 14.5496C12.9569 14.6501 12.8914 14.7404 12.81 14.8149L8.16001 19.4649L7.00001 20.6174L5.06001 22.5599C4.98403 22.6364 4.89367 22.6971 4.79413 22.7386C4.69459 22.78 4.58783 22.8013 4.48001 22.8013C4.3722 22.8013 4.26544 22.78 4.1659 22.7386C4.06636 22.6971 3.976 22.6364 3.90001 22.5599ZM11.4425 21.1924C11.453 21.3018 11.4196 21.4109 11.3498 21.4957C11.28 21.5805 11.1794 21.6342 11.07 21.6449H11.03C10.976 21.6502 10.9215 21.6447 10.8695 21.6288C10.8176 21.613 10.7694 21.587 10.7275 21.5524C10.6428 21.4812 10.5891 21.38 10.5775 21.2699L10.275 18.0449L11.0725 17.2499L11.4425 21.1924ZM8.39001 21.1424C8.41178 21.2504 8.39023 21.3627 8.33001 21.4549C8.29994 21.5007 8.261 21.54 8.21548 21.5705C8.16997 21.601 8.1188 21.6221 8.06501 21.6324H8.03001C7.97612 21.6453 7.92019 21.6471 7.86556 21.6379C7.81094 21.6286 7.75873 21.6085 7.71207 21.5786C7.6654 21.5487 7.62523 21.5098 7.59396 21.464C7.56268 21.4183 7.54093 21.3668 7.53001 21.3124L7.43501 20.8674L8.17001 20.1324L8.39001 21.1424ZM19.83 22.1624C19.7817 22.4663 19.6264 22.7428 19.3922 22.9422C19.1579 23.1416 18.8601 23.2508 18.5525 23.2499H6.44751C6.26891 23.2491 6.09245 23.2111 5.92933 23.1383C5.76621 23.0656 5.62 22.9597 5.50001 22.8274L7.03001 21.2974L7.05501 21.4224C7.09857 21.6282 7.21149 21.8128 7.37488 21.9452C7.53827 22.0776 7.74219 22.1499 7.95251 22.1499C8.01641 22.1506 8.08016 22.1439 8.14251 22.1299H8.17751C8.29524 22.1055 8.40699 22.0582 8.5064 21.9905C8.6058 21.9229 8.69091 21.8364 8.75685 21.7358C8.82278 21.6353 8.86826 21.5228 8.89068 21.4046C8.9131 21.2865 8.91203 21.1651 8.88751 21.0474L8.61251 19.7249L9.81501 18.4999L10.08 21.3149C10.1001 21.5444 10.206 21.7577 10.3766 21.9125C10.5471 22.0673 10.7697 22.1521 11 22.1499H11.0875H11.1275C11.3694 22.1265 11.5922 22.0081 11.7469 21.8206C11.9015 21.6331 11.9755 21.3919 11.9525 21.1499L11.5325 16.7874L13.1575 15.1649C13.2067 15.1129 13.2527 15.0578 13.295 14.9999H21L19.83 22.1624ZM19.83 4.03244C19.9368 4.00518 20.0484 4.00273 20.1563 4.02526C20.2642 4.0478 20.3655 4.09472 20.4525 4.16244C20.5435 4.22787 20.6178 4.31378 20.6695 4.41322C20.7212 4.51267 20.7488 4.62287 20.75 4.73494V11.7974H13.5925V5.61994L14.25 5.45244V8.03494C14.2504 8.182 14.2923 8.32597 14.3709 8.45023C14.4496 8.5745 14.5618 8.67399 14.6946 8.73724C14.8273 8.80049 14.9753 8.82491 15.1213 8.8077C15.2674 8.79048 15.4056 8.73232 15.52 8.63994L15.8675 8.35994L16.215 8.63994C16.3288 8.73805 16.4686 8.80108 16.6175 8.82141C16.7664 8.84174 16.9179 8.81849 17.0539 8.75449C17.1898 8.69049 17.3043 8.58847 17.3835 8.46077C17.4626 8.33307 17.5031 8.18516 17.5 8.03494V4.62994L19.3075 4.16994L19.83 4.03244ZM11.9075 11.7974V5.67744H13.0925V11.7974H11.9075ZM14.75 5.32494L17 4.74994V8.03494C16.9999 8.08736 16.985 8.13869 16.957 8.18298C16.929 8.22728 16.889 8.26272 16.8416 8.28522C16.7943 8.30772 16.7415 8.31634 16.6895 8.3101C16.6374 8.30385 16.5882 8.28299 16.5475 8.24994L16.0475 7.84244C16.003 7.8063 15.9474 7.78659 15.89 7.78659C15.8327 7.78659 15.7771 7.8063 15.7325 7.84244L15.2325 8.24994C15.1921 8.28328 15.143 8.30439 15.091 8.31077C15.039 8.31715 14.9862 8.30854 14.9389 8.28595C14.8917 8.26336 14.8518 8.22773 14.8241 8.18326C14.7964 8.13879 14.782 8.08733 14.7825 8.03494L14.75 5.32494ZM18.525 2.54994C18.5736 2.52216 18.6287 2.50773 18.6847 2.50811C18.7407 2.50848 18.7955 2.52366 18.8438 2.55208C18.892 2.58051 18.9319 2.62119 18.9593 2.66998C18.9867 2.71878 19.0008 2.77396 19 2.82994V3.72994L13.6775 5.08244L18.525 2.54994ZM16.6775 1.81244C16.708 1.78371 16.7462 1.76451 16.7874 1.75718C16.8286 1.74985 16.8711 1.75471 16.9095 1.77117C16.948 1.78763 16.9809 1.81497 17.0041 1.84983C17.0272 1.8847 17.0397 1.92557 17.04 1.96744V2.76244L13.9825 4.35744L16.6775 1.81244ZM7.96001 1.96744C7.96029 1.92557 7.97278 1.8847 7.99596 1.84983C8.01914 1.81497 8.05199 1.78763 8.09048 1.77117C8.12898 1.75471 8.17144 1.74985 8.21266 1.75718C8.25387 1.76451 8.29206 1.78371 8.32251 1.81244L11.0175 4.35744L7.96001 2.76244V1.96744ZM6.00001 2.99994C5.99926 2.92706 6.01748 2.85523 6.0529 2.79153C6.08831 2.72783 6.13969 2.67443 6.20198 2.6366C6.26428 2.59877 6.33535 2.5778 6.4082 2.57576C6.48106 2.57371 6.55319 2.59066 6.61751 2.62494L11.32 5.07744L6.00001 3.72744V2.99994ZM4.25001 4.72994C4.24924 4.61936 4.27412 4.5101 4.3227 4.41076C4.37129 4.31143 4.44225 4.22471 4.53001 4.15744C4.61698 4.08972 4.7183 4.0428 4.82619 4.02026C4.93409 3.99773 5.04571 4.00019 5.15251 4.02744L5.69001 4.16494L11.395 5.61494V11.7974H4.25001V4.72994ZM2.72251 12.7499C2.72251 12.6317 2.76932 12.5182 2.8527 12.4344C2.93608 12.3505 3.04926 12.3031 3.16751 12.3024H21.8325C21.9508 12.3031 22.0639 12.3505 22.1473 12.4344C22.2307 12.5182 22.2775 12.6317 22.2775 12.7499V14.0574C22.2769 14.175 22.2297 14.2876 22.1463 14.3705C22.0629 14.4534 21.9501 14.4999 21.8325 14.4999H13.515C13.5543 14.3085 13.5506 14.1107 13.504 13.9209C13.4574 13.7311 13.3691 13.554 13.2456 13.4025C13.1221 13.251 12.9665 13.1289 12.79 13.045C12.6134 12.9611 12.4205 12.9175 12.225 12.9174C12.052 12.9168 11.8806 12.9507 11.7209 13.0172C11.5612 13.0838 11.4164 13.1816 11.295 13.3049L10.0975 14.4999H3.16751C3.04949 14.4999 2.93631 14.4531 2.85285 14.3696C2.7694 14.2861 2.72251 14.173 2.72251 14.0549V12.7499Z" fill="#3799FF"/>
                        <path d="M13.0575 21.1449C13.0345 21.3868 13.1085 21.628 13.2632 21.8155C13.4178 22.003 13.6406 22.1215 13.8825 22.1449H13.9225H14C14.2278 22.1446 14.4473 22.0594 14.6156 21.9059C14.7839 21.7524 14.8889 21.5417 14.91 21.3149L15.3325 16.8149C15.3555 16.5729 15.2815 16.3317 15.1269 16.1442C14.9722 15.9567 14.7494 15.8383 14.5075 15.8149H14.4675C14.3475 15.8035 14.2265 15.8159 14.1112 15.8513C13.996 15.8868 13.8889 15.9446 13.7961 16.0214C13.7032 16.0983 13.6264 16.1927 13.57 16.2992C13.5136 16.4058 13.4788 16.5224 13.4675 16.6424L13.0575 21.1449ZM13.5575 21.1924L13.98 16.6924C13.9894 16.5894 14.0368 16.4936 14.1131 16.4237C14.1895 16.3539 14.2891 16.3151 14.3925 16.3149H14.43H14.47C14.5242 16.3196 14.5769 16.335 14.625 16.3602C14.6732 16.3855 14.7158 16.42 14.7505 16.4619C14.7851 16.5038 14.8111 16.5521 14.8269 16.6041C14.8427 16.6562 14.848 16.7108 14.8425 16.7649L14.4225 21.2649C14.411 21.3749 14.3572 21.4762 14.2725 21.5474C14.2307 21.5819 14.1824 21.6079 14.1305 21.6238C14.0786 21.6397 14.024 21.6451 13.97 21.6399H13.93C13.8216 21.6291 13.7218 21.5761 13.6521 21.4924C13.5824 21.4087 13.5485 21.3009 13.5575 21.1924Z" fill="#3799FF"/>
                        <path d="M16.8275 22.1225H16.8675C16.9293 22.1342 16.9921 22.14 17.055 22.14C17.2653 22.1399 17.4693 22.0676 17.6326 21.9352C17.796 21.8028 17.909 21.6182 17.9525 21.4125L18.39 19.31L18.8725 17C18.9213 16.7623 18.874 16.515 18.741 16.3121C18.6079 16.1093 18.3999 15.9674 18.1625 15.9175H18.1225C17.8849 15.8686 17.6376 15.9159 17.4347 16.049C17.2318 16.182 17.0899 16.39 17.04 16.6275L16.12 21.04C16.0704 21.2773 16.1171 21.5246 16.2498 21.7276C16.3824 21.9306 16.5902 22.0726 16.8275 22.1225ZM16.61 21.1425L17.53 16.73C17.5496 16.6364 17.6008 16.5526 17.675 16.4924C17.7493 16.4323 17.842 16.3997 17.9375 16.4H18.0225H18.06C18.1141 16.4115 18.1653 16.4336 18.2108 16.4651C18.2563 16.4965 18.2951 16.5365 18.3251 16.583C18.355 16.6295 18.3755 16.6814 18.3854 16.7358C18.3952 16.7901 18.3943 16.8459 18.3825 16.9L17.9 19.2175L17.46 21.32C17.4491 21.3743 17.4273 21.4258 17.3961 21.4716C17.3648 21.5173 17.3246 21.5563 17.2779 21.5861C17.2313 21.616 17.1791 21.6361 17.1245 21.6454C17.0698 21.6546 17.0139 21.6528 16.96 21.64H16.92C16.817 21.6151 16.7274 21.5515 16.67 21.4625C16.6392 21.4158 16.618 21.3635 16.6077 21.3085C16.5974 21.2536 16.5982 21.1971 16.61 21.1425Z" fill="#3799FF"/>
                        </svg>




                    </div>
                  </div>
                  <div>
                    <div class="d-flex align-items-center mb-1">
                      <h6 class="mb-0 fw-bold me-2">
                        {{ lang === 'ar' ? 'طلب رقم' : 'Order' }} {{ order.order_no }}
                      </h6>
                      <button
                        type="button"
                        class="btn btn-sm btn-light-info p-1"
                        (click)="copyOrderNo(order.order_no)"
                        [title]="lang === 'ar' ? 'نسخ رقم الطلب' : 'Copy Order Number'">
                        <i class="ki-outline ki-copy fs-6"></i>
                      </button>
                    </div>
                    <div *ngIf="order.user" class="text-muted fs-7">{{ lang === 'ar' ? 'العميل' : 'Client' }}: {{ order?.user?.name || '' }}</div>
                  </div>
                </div>
                <div class="d-flex gap-2">
                  <button
                    type="button"
                    class="btn btn-info btn-sm"
                    (click)="openOrderDetails(order)">
                    {{ lang === 'ar' ? 'تفاصيل الطلب' : 'Order Details' }}
                  </button>
                  <button
                    type="button"
                    class="btn btn-light-info btn-sm"
                    (click)="downloadInvoice(order)">
                    <i class="ki-outline ki-file-down fs-6 me-1"></i>
                    {{ lang === 'ar' ? 'تحميل الفاتورة' : 'Download Invoice' }}
                  </button>
                </div>
              </div>

        


              <!-- Knowledge Items -->
              <div *ngIf="order.orderable" class="mb-3">
                <div *ngFor="let knowledge of order.orderable.knowledge" class="mb-2">
                  <div class="d-flex align-items-center">
                    <div>
                      <a
                        [pTooltip]="lang ==='ar' ? 'عرض في التحميلات' : 'View in downloads'"
                        (click)="navigateToDownloads(order)"
                        target="_blank"
                        class="text-info text-decoration-none fw-bold fs-6 cursor-pointer">
                        {{ knowledge.title }}
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Documents Preview -->
              <div *ngIf="order.orderable.knowledge_documents && order.orderable.knowledge_documents.length > 0" class="mt-2">
                <div class="d-flex flex-wrap pt-2 gap-2">
                  <div *ngFor="let extension of getUniqueExtensions(order.orderable)" class="position-relative d-inline-block">
                    <img
                      [src]="getFileIconByExtension(extension)"
                      [alt]="extension"
                      class="file-icon"
                      style="width: 40px; height: 40px;"
                      onerror="this.style.display='none'">
                    <span
                      class="position-absolute top-0 start-75 translate-middle badge rounded-pill text-white"
                      [style.background-color]="getBadgeColorByExtension(extension)">
                      {{ getDocumentCountByExtension(order.orderable, extension) }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="(salesOrders$ | async)?.length === 0 && !(isSalesLoading$ | async)" class="col-12">
          <div class="card">
            <div class="text-center py-10">
              <div class="symbol symbol-100px mx-auto mb-4">
                <div class="symbol-label bg-light-success">
                  <i class="ki-outline ki-chart-line fs-2 text-success"></i>
                </div>
              </div>
              <h5 class="mb-3">{{ lang === 'ar' ? 'لا توجد طلبات مبيعات' : 'No Sales Orders Found' }}</h5>
              <p class="text-muted">
                {{ lang === 'ar' ? 'لم تقم بأي مبيعات بعد' : 'You have no sales orders yet.' }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="(salesTotalPages$ | async)! > 1" class="d-flex justify-content-center mt-6">
        <p-paginator
          [rows]="10"
          [totalRecords]="(salesTotalPages$ | async)! * 10"
          [first]="(currentSalesPage - 1) * 10"
          (onPageChange)="onSalesPageChange(($event.page || 0) + 1)"
          [showCurrentPageReport]="true"
          [currentPageReportTemplate]="lang === 'ar' ? 'عرض {first} إلى {last} من {totalRecords} طلب' : 'Showing {first} to {last} of {totalRecords} orders'">
        </p-paginator>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Meeting Orders Tab -->
  <div *ngIf="activeTab === 'meeting'">
    <div class="row mb-0" *ngIf="canViewSalesTabs">
      <div class="col-12">
        <div class="nested-tab-nav">
          <button
            type="button"
            class="nested-tab-button"
            [ngClass]="{ 'active': meetingSubTab === 'purchased' }"
            (click)="setMeetingSubTab('purchased')">
            {{ lang === 'ar' ? 'الاجتماعات المحجوزة' : 'Purchased' }}
          </button>
          <button
            type="button"
            class="nested-tab-button"
            [ngClass]="{ 'active': meetingSubTab === 'sales' }"
            (click)="setMeetingSubTab('sales')">
            {{ lang === 'ar' ? 'اجتماعات المبيعات' : 'Sold' }}
          </button>
        </div>
      </div>
    </div>


    <ng-container *ngIf="meetingSubTab === 'purchased'">
      <div class="nested-tab-content">
        <div class="row g-4">
      <!-- Loading State -->
      <div *ngIf="isMeetingLoading$ | async" class="col-12">
        <div class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
          <div class="spinner-border text-info" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">{{ lang === 'ar' ? 'جاري التحميل...' : 'Loading...' }}</span>
          </div>
        </div>
      </div>

      <!-- Meeting Orders Cards -->
      <div *ngFor="let order of meetingOrders$ | async" class="col-12">
        <div class="card card-custom gutter-b">
          <div class="card-body p-6">
            <!-- Order Header -->
            <div class="d-flex justify-content-between align-items-start mb-4">
              <div class="d-flex align-items-center">
                <div class="symbol symbol-40px me-3">
                  <div class="symbol-label bg-light-info">
                    <i class="ki-outline ki-calendar fs-2x text-info"></i>
                  </div>
                </div>
                <div>
                  <div class="d-flex align-items-center mb-1">
                    <h6 class="mb-0 fw-bold me-2">
                      {{ lang === 'ar' ? 'طلب رقم' : 'Order' }} {{ order.order_no }}
                    </h6>
                    <button 
                      type="button" 
                      class="btn btn-sm btn-light-info p-1"
                      (click)="copyOrderNo(order.order_no)"
                      [title]="lang === 'ar' ? 'نسخ رقم الطلب' : 'Copy Order Number'">
                      <i class="ki-outline ki-copy fs-6"></i>
                    </button>
                  </div>
                  <div class="text-muted fs-7">{{ order.amount === 0 ? (lang === 'ar' ? 'مجاني' : 'Free') : '$' + order.amount }}</div>
                </div>
              </div>
              <div class="d-flex gap-2">
                <button 
                  type="button" 
                  class="btn btn-info btn-sm"
                  (click)="openMeetingOrderDetails(order)">
                  {{ lang === 'ar' ? 'تفاصيل الطلب' : 'Order Details' }}
                </button>
                <button 
                  type="button" 
                  class="btn btn-light-info btn-sm"
                  (click)="downloadInvoice(order)">
                  <i class="ki-outline ki-file-down fs-6 me-1"></i>
                  {{ lang === 'ar' ? 'تحميل الفاتورة' : 'Download Invoice' }}
                </button>
              </div>
            </div>

            <!-- Order Info Row -->
            <div class="mb-4 d-flex flex-wrap gap-3">
              <div>
                <span class="text-muted fs-7">{{ lang === 'ar' ? 'النوع:' : 'Type:' }}</span>
                <span class="ms-2 fw-semibold">{{ getServiceTypeDisplay(order.service) }}</span>
              </div>
           
              <div>
                <span class="text-muted fs-7">{{ lang === 'ar' ? 'الحالة:' : 'Status:' }}</span>
                <span class="ms-2 text-uppercase" [ngClass]="getStatusBadgeClass(order.status)">
                  {{ order.status }}
                </span>
              </div>
            </div>

            <!-- Meeting Details -->
            <div *ngIf="order.orderable">
              <div *ngIf="order.orderable.meeting_booking" class="bg-light-info rounded p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <div>
                    <h6 class="mb-1 fw-bold text-dark">{{ order.orderable.meeting_booking.title }}</h6>
                    <p class="text-muted fs-7 mb-0">{{ order.orderable.meeting_booking.description }}</p>
                  </div>
                  <span class="badge" [ngClass]="getMeetingStatusBadgeClass(order.orderable.meeting_booking.status)">
                    {{ getMeetingStatusDisplay(order.orderable.meeting_booking.status) }}
                  </span>
                </div>
                
                <div class="row g-3 mt-2">
                  <div class="col-md-4">
                    <div class="d-flex align-items-center">
                      <i class="ki-outline ki-calendar fs-5 text-info me-2"></i>
                      <div>
                        <div class="fs-8 text-muted">{{ lang === 'ar' ? 'التاريخ' : 'Date' }}</div>
                        <div class="fw-semibold fs-7">{{ order.orderable.meeting_booking.date | date:'mediumDate' }}</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="d-flex align-items-center">
                      <i class="ki-outline ki-time fs-5 text-info me-2"></i>
                      <div>
                        <div class="fs-8 text-muted">{{ lang === 'ar' ? 'الوقت' : 'Time' }}</div>
                        <div class="fw-semibold fs-7">{{ order.orderable.meeting_booking.start_time }} - {{ order.orderable.meeting_booking.end_time }}</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="d-flex align-items-center">
                      <i class="ki-outline ki-timer fs-5 text-info me-2"></i>
                      <div>
                        <div class="fs-8 text-muted">{{ lang === 'ar' ? 'المدة' : 'Duration' }}</div>
                        <div class="fw-semibold fs-7">{{ calculateDuration(order.orderable.meeting_booking.start_time, order.orderable.meeting_booking.end_time) }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Order Date -->
            <div class="border-top pt-3 mt-4">
              <div class="text-muted fs-7">
                {{ lang === 'ar' ? 'تاريخ الطلب' : 'Ordered' }} {{ order.date | date:'short' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State for Meeting Orders -->
      <div *ngIf="(meetingOrders$ | async)?.length === 0 && !(isMeetingLoading$ | async)" class="col-12">
        <div class="card">
          <div class="text-center py-10">
            <div class="symbol symbol-100px mx-auto mb-4">
              <div class="symbol-label bg-light-info">
                <i class="ki-outline ki-calendar fs-3x text-info"></i>
              </div>
            </div>
            <h5 class="mb-3">{{ lang === 'ar' ? 'لا توجد طلبات اجتماعات' : 'No Meeting Orders Found' }}</h5>
            <p class="text-muted">
              {{ lang === 'ar' ? 'لم تقم بأي طلبات اجتماعات بعد' : 'You haven\'t placed any meeting orders yet.' }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination for Meeting Orders -->
    <div *ngIf="(meetingTotalPages$ | async)! > 1" class="d-flex justify-content-center mt-6">
      <p-paginator 
        [rows]="10" 
        [totalRecords]="(meetingTotalPages$ | async)! * 10"
        [first]="(currentMeetingPage - 1) * 10"
        (onPageChange)="onMeetingPageChange(($event.page || 0) + 1)"
        [showCurrentPageReport]="true"
        [currentPageReportTemplate]="lang === 'ar' ? 'عرض {first} إلى {last} من {totalRecords} طلب اجتماع' : 'Showing {first} to {last} of {totalRecords} meeting orders'">
      </p-paginator>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="meetingSubTab === 'sales'">
      <div class="nested-tab-content">
        <div class="row g-4">
        <div *ngIf="isMeetingSalesLoading$ | async" class="col-12">
          <div class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
            <div class="spinner-border text-info" role="status" style="width: 3rem; height: 3rem;">
              <span class="visually-hidden">{{ lang === 'ar' ? 'جاري التحميل...' : 'Loading...' }}</span>
            </div>
          </div>
        </div>

        <div *ngFor="let order of meetingSalesOrders$ | async" class="col-12">
          <div class="card card-custom gutter-b">
            <div class="card-body p-6">
              <!-- Order Header -->
              <div class="d-flex justify-content-between align-items-start mb-4">
                <div class="d-flex align-items-center">
                  <div class="symbol symbol-40px me-3">
                    <div class="symbol-label bg-light-info">
                      <i class="ki-outline ki-calendar fs-2x text-info"></i>
                    </div>
                  </div>
                  <div>
                    <div class="d-flex align-items-center mb-1">
                      <h6 class="mb-0 fw-bold me-2">
                        {{ lang === 'ar' ? 'طلب رقم' : 'Order' }} {{ order.order_no }}
                      </h6>
                      <button
                        type="button"
                        class="btn btn-sm btn-light-info p-1"
                        (click)="copyOrderNo(order.order_no)"
                        [title]="lang === 'ar' ? 'نسخ رقم الطلب' : 'Copy Order Number'">
                        <i class="ki-outline ki-copy fs-6"></i>
                      </button>
                    </div>
                    <div *ngIf="order.user" class="text-muted fs-7">{{ lang === 'ar' ? 'العميل' : 'Client' }}: {{ order?.user?.name || '' }}</div>
                  </div>
                </div>
                <div class="d-flex gap-2">
                  <button
                    type="button"
                    class="btn btn-info btn-sm"
                    (click)="openMeetingOrderDetails(order)">
                    {{ lang === 'ar' ? 'تفاصيل الطلب' : 'Order Details' }}
                  </button>
                  <button
                    type="button"
                    class="btn btn-light-info btn-sm"
                    (click)="downloadInvoice(order)">
                    <i class="ki-outline ki-file-down fs-6 me-1"></i>
                    {{ lang === 'ar' ? 'تحميل الفاتورة' : 'Download Invoice' }}
                  </button>
                </div>
              </div>

              <!-- Meeting Items -->
              <div *ngIf="order.orderable" class="mb-3">
                <div *ngIf="order.orderable.meeting_booking" class="bg-light-info rounded p-4">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                      <h6 class="mb-1 fw-bold text-dark">{{ order.orderable.meeting_booking.title }}</h6>
                      <p class="text-muted fs-7 mb-0">{{ order.orderable.meeting_booking.description }}</p>
                    </div>
                    <span class="badge" [ngClass]="getMeetingStatusBadgeClass(order.orderable.meeting_booking.status)">
                      {{ getMeetingStatusDisplay(order.orderable.meeting_booking.status) }}
                    </span>
                  </div>

                  <div class="row g-3">
                    <div class="col-md-4">
                      <div class="d-flex align-items-center">
                        <i class="ki-outline ki-calendar-8 fs-5 text-info me-2"></i>
                        <div>
                          <div class="fs-8 text-muted">{{ lang === 'ar' ? 'تاريخ الاجتماع' : 'Date' }}</div>
                          <div class="fw-semibold fs-7">{{ order.orderable.meeting_booking.date | date:'mediumDate' }}</div>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="d-flex align-items-center">
                        <i class="ki-outline ki-time fs-5 text-info me-2"></i>
                        <div>
                          <div class="fs-8 text-muted">{{ lang === 'ar' ? 'الوقت' : 'Time' }}</div>
                          <div class="fw-semibold fs-7">{{ order.orderable.meeting_booking.start_time }} - {{ order.orderable.meeting_booking.end_time }}</div>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="d-flex align-items-center">
                        <i class="ki-outline ki-timer fs-5 text-info me-2"></i>
                        <div>
                          <div class="fs-8 text-muted">{{ lang === 'ar' ? 'المدة' : 'Duration' }}</div>
                          <div class="fw-semibold fs-7">{{ calculateDuration(order.orderable.meeting_booking.start_time, order.orderable.meeting_booking.end_time) }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <div *ngIf="(meetingSalesOrders$ | async)?.length === 0 && !(isMeetingSalesLoading$ | async)" class="col-12">
          <div class="card">
            <div class="text-center py-10">
              <div class="symbol symbol-100px mx-auto mb-4">
                <div class="symbol-label bg-light-success">
                  <i class="ki-outline ki-briefcase fs-3x text-success"></i>
                </div>
              </div>
              <h5 class="mb-3">{{ lang === 'ar' ? 'لا توجد اجتماعات مباعة' : 'No Sales Meetings Found' }}</h5>
              <p class="text-muted">
                {{ lang === 'ar' ? 'لم تقم ببيع أي اجتماعات بعد' : 'You have no sales meetings yet.' }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="(meetingSalesTotalPages$ | async)! > 1" class="d-flex justify-content-center mt-6">
        <p-paginator
          [rows]="10"
          [totalRecords]="(meetingSalesTotalPages$ | async)! * 10"
          [first]="(currentMeetingSalesPage - 1) * 10"
          (onPageChange)="onMeetingSalesPageChange(($event.page || 0) + 1)"
          [showCurrentPageReport]="true"
          [currentPageReportTemplate]="lang === 'ar' ? 'عرض {first} إلى {last} من {totalRecords} اجتماع' : 'Showing {first} to {last} of {totalRecords} meetings'">
        </p-paginator>
      </div>
    </div> 
    </ng-container>
  </div>

<!-- Order Details Dialog -->
<p-dialog 
  [(visible)]="showOrderDetails" 
  [header]="lang === 'ar' ? 'تفاصيل الطلب' : 'Order Details'"
  [modal]="true" 
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '50vw', minWidth: '300px' }"
  [contentStyle]="{ 'max-height': '70vh', 'overflow-y': 'auto' }"
  appendTo="body">
  
  <div *ngIf="selectedOrder" class="order-details">
    <!-- Order Header -->
    <div class="mb-4">
      <h6 class="fw-bold mb-2">
        {{ lang === 'ar' ? 'طلب رقم' : 'Order' }} {{ selectedOrder.order_no }}
      </h6>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'المبلغ:' : 'Amount:' }}</span>
        <span class="fw-bold">{{ selectedOrder.amount === 0 ? (lang === 'ar' ? 'مجاني' : 'Free') : '$'+ selectedOrder.amount }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'الحالة:' : 'Status:' }}</span>
        <span class="text-uppercase" [ngClass]="getStatusBadgeClass(selectedOrder.status)">{{ selectedOrder.status }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'التاريخ:' : 'Date:' }}</span>
        <span>{{ selectedOrder.date | date:'medium' }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'النوع:' : 'Type:' }}</span>
        <span class="fw-bold">{{ getServiceTypeDisplay(selectedOrder.service) }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center">
        <span class="text-muted">{{ lang === 'ar' ? 'طريقة الدفع:' : 'Payment:' }}</span>
        <div class="d-flex align-items-center">
          <div class="payment-method-display d-inline-flex align-items-center bg-light-info rounded px-2 py-1">
            <ng-container *ngIf="shouldShowCardLogo(selectedOrder.payment); else showIcon3">
              <div class="me-2" [innerHTML]="getCardLogoSvg(selectedOrder.payment)" style="width: 24px; height: 16px; display: flex; align-items: center;"></div>
            </ng-container>
            <ng-template #showIcon3>
              <i class="fs-6 me-2 text-info" [ngClass]="getPaymentMethodIcon(selectedOrder.payment)"></i>
            </ng-template>
            <span class="fw-bold text-dark">{{ getPaymentMethodDisplay(selectedOrder.payment) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Knowledge Items -->
    <div *ngIf="selectedOrder.orderable" class="mb-4">
      <div *ngFor="let knowledge of selectedOrder.orderable.knowledge" class="border rounded p-3 mb-3">
        <h6 class="mb-6 text-info">
          <div
            class="text-info text-decoration-none">
            {{ knowledge.title }}
          </div>
        </h6>
        
        <!-- Documents -->
        <div *ngIf="selectedOrder.orderable.knowledge_documents && selectedOrder.orderable.knowledge_documents.length > 0">
          <h6 class="fs-7 text-muted mb-2">{{ lang === 'ar' ? 'المستندات:' : 'Documents:' }}</h6>
          <div class="row g-2">
            <ng-container *ngFor="let docGroup of selectedOrder.orderable.knowledge_documents">
              <div *ngFor="let doc of docGroup" class="col-md-12">
                <div class="card card-flush border border-gray-300">
                  <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                      <img 
                        [src]="getFileIconByExtension(doc.file_extension)" 
                        [alt]="doc.file_extension"
                        class="me-3"
                        style="width: 40px; height: 40px;"
                        onerror="this.style.display='none'">
                      <div class="flex-grow-1">
                        <div class="fw-bold fs-6">{{ doc.file_name }}</div>
                        <div class="text-muted fs-7">{{ doc.file_extension.toUpperCase() }}</div>
                      </div>
                      <div class="text-end">
                        <div class="fw-bold text-info">{{ doc.price === 0 ? (lang === 'ar' ? 'مجاني' : 'Free') : '$' + doc.price }}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

  </div>
</p-dialog>

<!-- Meeting Order Details Dialog -->
<p-dialog 
  [(visible)]="showMeetingOrderDetails" 
  [header]="lang === 'ar' ? 'تفاصيل طلب الاجتماع' : 'Meeting Order Details'"
  [modal]="true" 
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '50vw', minWidth: '300px' }"
  [contentStyle]="{ 'max-height': '70vh', 'overflow-y': 'auto' }"
  appendTo="body">
  
  <div *ngIf="selectedMeetingOrder" class="order-details">
    <!-- Order Header -->
    <div class="mb-4">
      <h6 class="fw-bold mb-2">
        {{ lang === 'ar' ? 'طلب رقم' : 'Order' }} {{ selectedMeetingOrder.order_no }}
      </h6>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'المبلغ:' : 'Amount:' }}</span>
        <span class="fw-bold">{{ selectedMeetingOrder.amount === 0 ? (lang === 'ar' ? 'مجاني' : 'Free') : '$'+ selectedMeetingOrder.amount }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'الحالة:' : 'Status:' }}</span>
        <span class="text-uppercase" [ngClass]="getStatusBadgeClass(selectedMeetingOrder.status)">{{ selectedMeetingOrder.status }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'التاريخ:' : 'Date:' }}</span>
        <span>{{ selectedMeetingOrder.date | date:'medium' }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">{{ lang === 'ar' ? 'النوع:' : 'Type:' }}</span>
        <span class="fw-bold">{{ getServiceTypeDisplay(selectedMeetingOrder.service) }}</span>
      </div>
      <div class="d-flex justify-content-between align-items-center">
        <span class="text-muted">{{ lang === 'ar' ? 'طريقة الدفع:' : 'Payment:' }}</span>
        <div class="d-flex align-items-center">
          <div class="payment-method-display d-inline-flex align-items-center bg-light-info rounded px-2 py-1">
            <ng-container *ngIf="shouldShowCardLogo(selectedMeetingOrder.payment); else showIcon4">
              <div class="me-2" [innerHTML]="getCardLogoSvg(selectedMeetingOrder.payment)" style="width: 24px; height: 16px; display: flex; align-items: center;"></div>
            </ng-container>
            <ng-template #showIcon4>
              <i class="fs-6 me-2 text-info" [ngClass]="getPaymentMethodIcon(selectedMeetingOrder.payment)"></i>
            </ng-template>
            <span class="fw-bold text-dark">{{ getPaymentMethodDisplay(selectedMeetingOrder.payment) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Meeting Bookings Details -->
    <div *ngIf="selectedMeetingOrder.orderable" class="mb-4">
      <div *ngIf="selectedMeetingOrder.orderable.meeting_booking" class="border rounded p-4">
        <div class="d-flex justify-content-between align-items-start mb-3">
          <div>
            <h6 class="mb-2 fw-bold text-dark">{{ selectedMeetingOrder.orderable.meeting_booking.title }}</h6>
            <p class="text-muted fs-7 mb-0">{{ selectedMeetingOrder.orderable.meeting_booking.description }}</p>
          </div>
          <span class="badge" [ngClass]="getMeetingStatusBadgeClass(selectedMeetingOrder.orderable.meeting_booking.status)">
            {{ getMeetingStatusDisplay(selectedMeetingOrder.orderable.meeting_booking.status) }}
          </span>
        </div>
        
        <div class="row g-3">
          <div class="col-md-4">
            <div class="d-flex align-items-center">
              <i class="ki-outline ki-calendar fs-5 text-info me-2"></i>
              <div>
                <div class="fs-8 text-muted">{{ lang === 'ar' ? 'التاريخ' : 'Date' }}</div>
                <div class="fw-semibold">{{ selectedMeetingOrder.orderable.meeting_booking.date | date:'mediumDate' }}</div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="d-flex align-items-center">
              <i class="ki-outline ki-time fs-5 text-info me-2"></i>
              <div>
                <div class="fs-8 text-muted">{{ lang === 'ar' ? 'الوقت' : 'Time' }}</div>
                <div class="fw-semibold">{{ selectedMeetingOrder.orderable.meeting_booking.start_time }} - {{ selectedMeetingOrder.orderable.meeting_booking.end_time }}</div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="d-flex align-items-center">
              <i class="ki-outline ki-timer fs-5 text-info me-2"></i>
              <div>
                <div class="fs-8 text-muted">{{ lang === 'ar' ? 'المدة' : 'Duration' }}</div>
                <div class="fw-semibold">{{ calculateDuration(selectedMeetingOrder.orderable.meeting_booking.start_time, selectedMeetingOrder.orderable.meeting_booking.end_time) }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</p-dialog>
