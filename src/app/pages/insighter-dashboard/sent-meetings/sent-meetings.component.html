<div class="container-fluid bg-white p-5 rounded-lg" style="border-radius: 10px;">
  <div class="row">
    <div class="col-12">
      <!-- Filter Tabs -->
      <div class="row mb-5">
        <div class="col-12">
          <div class="filter-tabs">
            <div class="nav nav-pills nav-pills-custom" role="tablist">
              <a class="nav-link"
                 role="tab"
                 [class.active]="selectedTab() === 'upcoming'"
                 (click)="onTabChange('upcoming')"
                 tabindex="0"
                 aria-selected="selectedTab() === 'upcoming'"
                 (keydown.enter)="onTabChange('upcoming')">
                {{ 'MEETINGS.TABS.UPCOMING' | translate }}
              </a>
              <!-- <a class="nav-link"
                 role="tab"
                 [class.active]="selectedTab() === 'pending'"
                 (click)="onTabChange('pending')"
                 tabindex="0"
                 aria-selected="selectedTab() === 'pending'"
                 (keydown.enter)="onTabChange('pending')">
                {{ 'MEETINGS.TABS.PENDING' | translate }}
              </a> -->
              <!-- <a class="nav-link"
                 role="tab"
                 [class.active]="selectedTab() === 'postponed'"
                 (click)="onTabChange('postponed')"
                 tabindex="0"
                 aria-selected="selectedTab() === 'postponed'"
                 (keydown.enter)="onTabChange('postponed')">
                {{ 'MEETINGS.TABS.POSTPONED' | translate }}
              </a> -->
              <a class="nav-link"
                 role="tab"
                 [class.active]="selectedTab() === 'past'"
                 (click)="onTabChange('past')"
                 tabindex="0"
                 aria-selected="selectedTab() === 'past'"
                 (keydown.enter)="onTabChange('past')">
                {{ 'MEETINGS.TABS.PAST' | translate }}
              </a>
              <!-- <a class="nav-link"
                 role="tab"
                 [class.active]="selectedTab() === 'approved'"
                 (click)="onTabChange('approved')"
                 tabindex="0"
                 aria-selected="selectedTab() === 'approved'"
                 (keydown.enter)="onTabChange('approved')">
                {{ 'MEETINGS.TABS.APPROVED' | translate }}
              </a> -->
            </div>
          </div>
        </div>
      </div>

      <!-- Archived Toggle Button for Past Meetings -->
      @if (selectedTab() === 'past') {
        <div class="row mb-4">
          <div class="col-12">
            <div class="d-flex justify-content-start">
              <button class="btn btn-outline-info d-flex align-items-center"
                      [class.active]="showArchivedMeetings()"
                      (click)="toggleArchivedMeetings()"
                      [pTooltip]="showArchivedMeetings() ? 'Show Past Meetings' : 'Show Archived Meetings'"
                      tooltipPosition="top">
                @if (showArchivedMeetings()) {
                  <i class="pi pi-arrow-left me-2 text-dark" style="font-size: 1rem;"></i>
                } @else {
                  <i class="pi pi-inbox me-2 text-dark" style="font-size: 1rem;"></i>
                }
                {{ showArchivedMeetings() ? 'Past' : 'Archived' }}
              </button>
            </div>
          </div>
        </div>
      }

      <!-- Loading State -->
      @if (loading()) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      }

      <!-- Meetings Grid -->
      @if (!loading()) {
        <div class="row g-4">
          @if (getFilteredMeetings().length === 0) {
            <div class="col-12">
              <div class="text-center py-5">
                <i class="ki-duotone ki-calendar-8 fs-3x text-gray-400 mb-3">
                  <span class="path1"></span>
                  <span class="path2"></span>
                  <span class="path3"></span>
                  <span class="path4"></span>
                  <span class="path5"></span>
                  <span class="path6"></span>
                </i>
                <h4 class="text-gray-700 mb-2">{{ 'MEETINGS.NO_MEETINGS' | translate }}</h4>
                <p class="text-gray-500">{{ 'MEETINGS.NO_MEETINGS_DESC' | translate }}</p>
              </div>
            </div>
          }

          @for (meeting of getFilteredMeetings(); track meeting.uuid; let i = $index) {
            <div class="col-xl-4 col-lg-6 col-md-6">
              <div class="card meeting-card h-100"
                   [class.closest-meeting]="isClosestMeeting(meeting, i)">
                <div class="card-body d-flex flex-column">
                  <!-- Meeting Header -->
                  <div class="d-flex align-items-center mb-4">
                    <div class="meeting-date-badge me-3">
                      <div class="month">{{ formatMonth(meeting.date) }}</div>
                      <div class="day">{{ formatDay(meeting.date) }}</div>
                    </div>
                    <div class="flex-grow-1">
                      <h5 class="card-title mb-1"
                          [pTooltip]="meeting.title"
                          tooltipPosition="top"
                          [style.cursor]="meeting.title && meeting.title.length > 30 ? 'help' : 'default'">
                        {{ meeting.title | truncateText:30 }}
                      </h5>
                      <div class="meeting-time text-muted">
                        <i class="ki-duotone ki-time me-1">
                          <span class="path1"></span>
                          <span class="path2"></span>
                        </i>
                        {{ formatTime(meeting.start_time) }} - {{ formatTime(meeting.end_time) }}
                      </div>
                    </div>
                  </div>

                  <!-- Meeting Status and Action Buttons -->
                  <div class="mb-3 d-flex align-items-center justify-content-between">
                    @if (meeting.status !== 'pending') {
                      <span class="badge" [ngClass]="getStatusClass(meeting.status)">
                        {{ ('MEETINGS.STATUS.' + meeting.status.toUpperCase()) | translate }}
                      </span>
                    }

                    <!-- Archive Button for Past Meetings -->
                    @if (selectedTab() === 'past' && !showArchivedMeetings()) {
                      <button class="btn btn-xs btn-light-warning d-flex align-items-center px-2 py-1"
                              (click)="archiveMeeting(meeting)"
                              [disabled]="actionLoading()"
                              [pTooltip]="'Archive Meeting'"
                              tooltipPosition="top"
                              aria-label="Archive Meeting">
                        <i class="pi pi-inbox" style="font-size: 1rem; padding: 0;"></i>
                      </button>
                    }
                  </div>

                  <!-- Meeting Description -->
                  <div class="meeting-description mb-4 flex-grow-1">
                    <p class="text-gray-600 mb-0"
                       [pTooltip]="meeting.description ? meeting.description : 'No description available'"
                       tooltipPosition="top"
                       [style.cursor]="meeting.description && meeting.description.length > 100 ? 'help' : 'default'">
                     {{ ( (meeting.description == "No description provided" || meeting.description == "No description available") ? ('INSIGHTER.MEETINGS.NO_DESCRIPTION' | translate) : meeting.description || ('INSIGHTER.MEETINGS.NO_DESCRIPTION' | translate) ) | truncateText:100:true }}
                    </p>
                  </div>

                  <!-- Insighter Info -->
                  <div class="meeting-participant">
                    <div class="d-flex align-items-center">
                      <div class="symbol symbol-40px me-3">
                      <a (click)="goToInsighterProfile(meeting)" tabindex="0" (keydown.enter)="goToInsighterProfile(meeting)">
                        @if (meeting.insighter.profile_photo_url) {
                          <img [src]="meeting.insighter.profile_photo_url"
                               [alt]="meeting.insighter.name"
                               class="rounded-circle"
                               style="object-position: top;">
                        } @else {
                          <div class="symbol-label bg-primary text-white">
                            {{ getInitials(meeting.insighter.name) }}
                          </div>
                        }
                      </a>
                      </div>
                      <div class="flex-grow-1">
                        <a (click)="goToInsighterProfile(meeting)" tabindex="0" (keydown.enter)="goToInsighterProfile(meeting)">
                          <div class="fw-bold text-gray-800"
                               [pTooltip]="meeting.insighter.name"
                               tooltipPosition="top"
                               [style.cursor]="meeting.insighter.name && meeting.insighter.name.length > 25 ? 'help' : 'default'">
                            {{ meeting.insighter.name | truncateText:25:true }}
                          </div>
                          <div class="text-muted fs-7">
                            <span class="badge badge-light-info">{{ 'INSIGHTER.ROLE' | translate }}</span>
                          </div>
                        </a>
                      </div>
                      <!-- Join Button for Approved Meetings with valid URL -->
                      @if (meeting.status === 'approved' && meeting.meeting_url && meeting.meeting_url !== '?pwd=') {
                        <div class="ms-2">
                          <button type="button"
                                  class="btn btn-sm btn-secondary"
                                  (click)="joinMeeting(meeting.meeting_url)"
                                  [pTooltip]="'MEETINGS.JOIN_MEETING' | translate"
                                  tooltipPosition="top">
                            <i class="ki-duotone ki-entrance-right me-1">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                            {{ 'MEETINGS.JOIN' | translate }}
                          </button>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              </div>
            </div>
          }

          <!-- Pagination -->
          @if (!loading() && currentTotalPages() > 1) {
            <div class="row mt-5">
              <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                  <div class="pagination-info text-muted">
                    {{ 'MEETINGS.SHOWING' | translate }}
                    {{ (currentDisplayPage() - 1) * perPage() + 1 }}
                    {{ 'MEETINGS.TO' | translate }}
                    {{ Math.min(currentDisplayPage() * perPage(), currentTotalItems()) }}
                    {{ 'MEETINGS.OF' | translate }}
                    {{ currentTotalItems() }}
                    {{ 'MEETINGS.RESULTS' | translate }}
                  </div>

                  <nav aria-label="Pagination">
                    <ul class="pagination pagination-outline">
                      <li class="page-item" [class.disabled]="currentDisplayPage() === 1">
                        @if (currentDisplayPage() > 1) {
                          <a class="page-link"
                             (click)="onPageChange(currentDisplayPage() - 1)"
                             tabindex="0"
                             aria-label="Previous page"
                             (keydown.enter)="onPageChange(currentDisplayPage() - 1)">
                            <i class="ki-duotone ki-black-left">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                          </a>
                        }
                      </li>

                      @for (page of pageNumbers(); track page) {
                        <li class="page-item" [class.active]="currentDisplayPage() === page">
                          <a class="page-link"
                             (click)="onPageChange(page)"
                             tabindex="0"
                             (keydown.enter)="onPageChange(page)">
                            {{ page }}
                          </a>
                        </li>
                      }

                      <li class="page-item" [class.disabled]="currentDisplayPage() === currentTotalPages()">
                        @if (currentDisplayPage() < currentTotalPages()) {
                          <a class="page-link"
                             (click)="onPageChange(currentDisplayPage() + 1)"
                             tabindex="0"
                             aria-label="Next page"
                             (keydown.enter)="onPageChange(currentDisplayPage() + 1)">
                            <i class="ki-duotone ki-black-right">
                              <span class="path1"></span>
                              <span class="path2"></span>
                            </i>
                          </a>
                        }
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
