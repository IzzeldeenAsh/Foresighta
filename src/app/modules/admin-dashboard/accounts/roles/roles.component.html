<p-progressBar
  *ngIf="isLoading$ | async"
  mode="indeterminate"
  [style]="{ height: '4px' }"
></p-progressBar>

<ng-container *ngIf="(isLoading$ | async) === false">
  <div class="p-30px">
    <div class="card card-flush h-xl-100">
      <!--begin::Header-->
      <div class="card-header pt-7">
        <!--begin::Title-->
        <h3 class="card-title align-items-start flex-column">
          <span class="card-label fw-bold text-gray-900">Roles List</span>
          <span class="text-gray-500 mt-1 fw-semibold fs-6">
            {{ roles.length }} Roles
          </span>
        </h3>
        <!--end::Title-->
        <div class="card-toolbar">
          <!-- <a (click)="showDialog()" class="btn btn-sm btn-flex btn-primary">
            <i class="ki-outline ki-plus text-white fs-4"></i>
            Create
          </a> -->
          <p-dialog
            [header]="isEditMode ? 'Edit Role' : 'Add Role'"
            [modal]="true"
            [(visible)]="visible"
            [style]="{ width: '40rem' }"
          >
            <p-messages
              *ngIf="hasErrorMessage"
              [(value)]="messages"
              [enableService]="false"
            ></p-messages>
            <span class="text-muted mb-3 d-block">
              {{ isEditMode ? 'Edit Role Details' : 'Add Role Details' }}.
            </span>

            <form [formGroup]="roleForm">
              <div class="mb-3 row">
                <label for="displayName" class="col-sm-3 col-form-label"
                  >Display Name</label
                >
                <div class="col-sm-9">
                  <input
                    pInputText
                    id="displayName"
                    class="form-control"
                    formControlName="displayName"
                    autocomplete="off"
                  />
                  <div
                    *ngIf="
                      displayName?.invalid && (displayName?.dirty || displayName?.touched)
                    "
                  >
                    <div
                      *ngIf="displayName?.errors?.required"
                      class="text-danger"
                    >
                      Display Name is required.
                    </div>
                    <div
                      *ngIf="displayName?.errors?.serverError"
                      class="text-danger"
                    >
                      {{ displayName?.errors?.serverError }}
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-3 row">
                <label for="description" class="col-sm-3 col-form-label"
                  >Description</label
                >
                <div class="col-sm-9">
                  <textarea
                    pInputTextarea
                    id="description"
                    class="form-control"
                    formControlName="description"
                    rows="3"
                  ></textarea>
                  <div
                    *ngIf="
                      description?.invalid && (description?.dirty || description?.touched)
                    "
                  >
                    <div
                      *ngIf="description?.errors?.required"
                      class="text-danger"
                    >
                      Description is required.
                    </div>
                    <div
                      *ngIf="description?.errors?.serverError"
                      class="text-danger"
                    >
                      {{ description?.errors?.serverError }}
                    </div>
                  </div>
                </div>
              </div>
            </form>

            <div class="d-flex justify-content-end gap-2">
              <button
                type="submit"
                [disabled]="roleForm.invalid || (isLoading$ | async)"
                (click)="submit()"
                class="btn btn-primary btn-sm"
              >
                <ng-container *ngIf="(isLoading$ | async) === false">
                  <span class="indicator-label">Save</span>
                </ng-container>
                <ng-container *ngIf="isLoading$ | async">
                  <span class="indicator-progress" [style.display]="'block'">
                    Please wait
                    <span
                      class="spinner-border spinner-border-sm align-middle ms-2"
                    ></span>
                  </span>
                </ng-container>
              </button>
              <button (click)="onCancel()" class="btn btn-outline-secondary btn-sm">
                Cancel
              </button>
            </div>
          </p-dialog>
        </div>
      </div>
      <!--end::Header-->

      <!--begin::Body-->
      <div class="card-body">
        <!--begin::Scroll-->
        <div
          class="hover-scroll-overlay-y pe-6 me-n6 d-flex flex-wrap gap-5"
        >
          <!--begin::Item-->
          <div
            *ngFor="let role of roles"
            class="border border-dashed border-gray-300 element rounded px-7 py-3 mb-6"
          >
            <!--begin::Info-->
            <div class="d-flex flex-stack mb-3">
              <!--begin::Wrapper-->
              <div class="me-3">
                <!--begin::Title-->
                <span class="text-gray-800 text-hover-primary fw-bold">{{
                  role.display_name
                }}</span>
                <!--end::Title-->
              </div>
              <!--end::Wrapper-->
              <!-- <div class="d-flex">
                <a
                  pTooltip="Edit Role"
                  tooltipPosition="top"
                  class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1"
                  (click)="editRole(role)"
                >
                  <i class="ki-duotone ki-pencil fs-2">
                    <span class="path1"></span><span class="path2"></span>
                  </i>
                </a>
                <a
                  pTooltip="Delete Role"
                  tooltipPosition="top"
                  class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm"
                  (click)="deleteRole(role.id)"
                >
                  <i class="ki-duotone ki-trash fs-2">
                    <span class="path1"></span><span class="path2"></span>
                    <span class="path3"></span><span class="path4"></span>
                    <span class="path5"></span>
                  </i>
                </a>
              </div> -->
            </div>
            <!--end::Info-->

            <!--begin::Description-->
            <div>
              <span class="text-gray-500">{{ role.description }}</span>
            </div>
            <!--end::Description-->
          </div>
          <!--end::Item-->
        </div>
        <!--end::Scroll-->
      </div>
      <!--end::Body-->
    </div>
  </div>
</ng-container>
