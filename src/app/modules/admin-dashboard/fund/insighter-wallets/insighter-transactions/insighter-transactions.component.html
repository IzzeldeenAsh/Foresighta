<div class="d-flex flex-column">
 

  <!-- Loading Indicator -->
  <div *ngIf="isLoading$ | async" class="d-flex justify-content-center align-items-center" style="min-height: 300px;">
    <div class="spinner-border text-info" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Transactions Table -->
  <div *ngIf="!(isLoading$ | async)" class="card">
    <div class="card-header border-0 pt-5">
      <h3 class="card-title align-items-start flex-column">
        <span class="card-label fw-bold fs-3 mb-1">Transactions</span>
        <span class="text-muted mt-1 fw-semibold fs-7">Total: {{ totalItems }} transactions</span>
      </h3>
    </div>

    <div class="card-body py-3">
      <div class="table-responsive">
        <table class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4">
          <thead>
            <tr class="fw-bold text-muted">
              <th class="min-w-150px">Transaction</th>
              <th class="min-w-140px">Amount</th>
              <th class="min-w-140px">Type</th>
              <th class="min-w-120px">Date</th>
              <th class="min-w-200px">Order Details</th>
              <th class="min-w-150px">Customer</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let transaction of transactions">
              <!-- Transaction Type -->
              <td>
                <div class="d-flex align-items-center">
                  <div class="symbol symbol-40px me-3">
                    <div class="symbol-label bg-light">
                      <i [class]="'ki-outline ' + getTransactionIcon(transaction) + ' fs-3'"></i>
                    </div>
                  </div>
                  <div class="d-flex flex-column">
                    <span class="text-dark fw-bold fs-6">{{ transaction.transaction | titlecase }}</span>
                    <span class="text-muted fw-semibold fs-7">{{ getTransactionTypeDisplay(transaction.type) }}</span>
                  </div>
                </div>
              </td>

              <!-- Amount -->
              <td>
                <span [class]="'fw-bold fs-6 ' + (transaction.transaction === 'deposit' ? 'text-success' : 'text-danger')">
                  {{ getAmountDisplay(transaction) }}
                </span>
              </td>

              <!-- Type -->
              <td>
                <span class="badge badge-light-info">{{ transaction.order.service | titlecase }}</span>
              </td>

              <!-- Date -->
              <td>
                <span class="text-dark fw-semibold fs-6">{{ formatDate(transaction.date) }}</span>
              </td>

              <!-- Order Details -->
              <td>
                <div class="d-flex flex-column">
                  <span class="text-dark fw-bold fs-6">{{ transaction.order.order_no }}</span>
                  <span class="text-muted fw-semibold fs-7">{{ transaction.order.invoice_no }}</span>
                  <span [class]="'badge badge-light-' + (transaction.order.status === 'paid' ? 'success' : 'warning') + ' mt-1'">
                    {{ transaction.order.status | titlecase }}
                  </span>

                  <!-- Meeting Details -->
                  <div *ngIf="transaction.order.sub_orders && transaction.order.sub_orders[0]?.meeting_booking" class="mt-2">
                    <div class="text-muted fs-7">
                      <strong>Meeting:</strong> {{ transaction.order.sub_orders[0].meeting_booking.title }}
                    </div>
                    <div class="text-muted fs-7">
                      <strong>Date:</strong> {{ transaction.order.sub_orders[0].meeting_booking.date }}
                      {{ transaction.order.sub_orders[0].meeting_booking.start_time }} -
                      {{ transaction.order.sub_orders[0].meeting_booking.end_time }}
                    </div>
                    <span [class]="'badge badge-light-' + (transaction.order.sub_orders[0].meeting_booking.status === 'pending' ? 'warning' : 'info')">
                      {{ transaction.order.sub_orders[0].meeting_booking.status | titlecase }}
                    </span>
                  </div>

                  <!-- Knowledge Details -->
                  <div *ngIf="transaction.order.sub_orders && transaction.order.sub_orders[0]?.knowledge" class="mt-2">
                    <div class="text-muted fs-7">
                      <strong>Knowledge:</strong> {{ transaction.order.sub_orders[0].knowledge[0].title }}
                    </div>
                    <span class="badge badge-light-primary">{{ transaction.order.sub_orders[0].knowledge[0].type | titlecase }}</span>
                    <div *ngIf="transaction.order.sub_orders[0].knowledge_documents" class="mt-1">
                      <div *ngFor="let docGroup of transaction.order.sub_orders[0].knowledge_documents">
                        <div *ngFor="let doc of docGroup" class="text-muted fs-7">
                          <i class="ki-outline ki-document fs-7"></i>
                          {{ doc.file_name }}.{{ doc.file_extension }} - ${{ doc.price }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </td>

              <!-- Customer -->
              <td>
                <div class="d-flex align-items-center">
                  <div class="symbol symbol-35px me-3">
                    <img *ngIf="transaction.order.user.profile_photo_url" [src]="transaction.order.user.profile_photo_url" alt="" />
                    <div *ngIf="!transaction.order.user.profile_photo_url" class="symbol-label bg-light-primary text-primary fw-bold">
                      {{ transaction.order.user.name.charAt(0) }}
                    </div>
                  </div>
                  <div class="d-flex flex-column">
                    <span class="text-dark fw-bold fs-6">{{ transaction.order.user.name }}</span>
                    <span class="text-muted fw-semibold fs-7">{{ transaction.order.user.email }}</span>
                    <div class="mt-1">
                      <span *ngFor="let role of transaction.order.user.roles" class="badge badge-light-success me-1">
                        {{ role | titlecase }}
                      </span>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div *ngIf="totalPages > 1" class="d-flex flex-stack flex-wrap pt-10">
        <div class="fs-6 fw-semibold text-gray-700">
          Showing {{ (currentPage - 1) * 10 + 1 }} to {{ Math.min(currentPage * 10, totalItems) }} of {{ totalItems }} entries
        </div>

        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="currentPage > 1 && onPageChange(currentPage - 1)">
              <i class="previous"></i>
            </a>
          </li>

          <li *ngFor="let page of [].constructor(totalPages); let i = index"
              class="page-item"
              [class.active]="currentPage === i + 1">
            <a class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }}</a>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="currentPage < totalPages && onPageChange(currentPage + 1)">
              <i class="next"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!(isLoading$ | async) && transactions.length === 0" class="card">
    <div class="card-body text-center py-15">
      <div class="text-center">
        <i class="ki-outline ki-finance-calculator fs-4x text-muted mb-5"></i>
        <h3 class="text-gray-800 fs-2 fw-bold mb-3">No Transactions Found</h3>
        <p class="text-gray-500 fs-6 fw-semibold mb-0">
          This insighter has no transaction history yet.
        </p>
      </div>
    </div>
  </div>
</div>